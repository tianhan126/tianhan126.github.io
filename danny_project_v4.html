<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËÉ°ËêùÂçúÂ°îÈò≤ - Â¢ûÂº∫Áâà</title>
    <style>
        body {
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            margin: 0;
            padding: 20px;
            text-align: center;
            min-height: 100vh;
            color: #2e7d32;
        }
        
        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 800px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 100, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        #game-title {
            color: #ff8f00;
            font-size: 2.8em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff8f00, #ffca28);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            z-index: 2;
        }
        
        #game-title::after {
            content: 'Â¢ûÂº∫Áâà';
            position: absolute;
            top: -10px;
            right: -40px;
            font-size: 0.4em;
            background: #e91e63;
            color: white;
            padding: 3px 10px;
            border-radius: 10px;
            transform: rotate(15deg);
        }
        
        #game-board {
            position: relative;
            width: 600px;
            height: 400px;
            background-color: #a5d6a7;
            border: 8px solid #81c784;
            border-radius: 15px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.1);
        }
        
        #carrot {
            position: absolute;
            right: 20px;
            bottom: 50px;
            font-size: 50px;
            z-index: 10;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .path {
            position: absolute;
            background-color: #8d6e63; /* ÂúüÂú∞Ëâ≤ */
            border-radius: 10px;
        }
        
        /* Êñ∞ÁöÑËúøËúíË∑ØÂæÑ */
        #path1 {
            width: 100px;
            height: 30px;
            left: 50px;
            top: 100px;
        }
        
        #path2 {
            width: 30px;
            height: 50px;
            left: 150px;
            top: 100px;
        }
        
        #path3 {
            width: 100px;
            height: 30px;
            left: 150px;
            top: 150px;
        }
        
        #path4 {
            width: 30px;
            height: 50px;
            left: 250px;
            top: 150px;
        }
        
        #path5 {
            width: 100px;
            height: 30px;
            left: 250px;
            top: 200px;
        }
        
        #path6 {
            width: 30px;
            height: 50px;
            left: 350px;
            top: 200px;
        }
        
        #path7 {
            width: 100px;
            height: 30px;
            left: 350px;
            top: 250px;
        }
        
        #path8 {
            width: 30px;
            height: 50px;
            left: 450px;
            top: 250px;
        }
        
        #path9 {
            width: 100px;
            height: 30px;
            left: 450px;
            top: 300px;
        }
        
        .tower {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            cursor: pointer;
            z-index: 5;
            transition: transform 0.2s;
            background: radial-gradient(circle at 30% 30%, #fff, #f1f8e9);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .tower:hover {
            transform: scale(1.1) rotate(5deg);
            z-index: 15;
        }
        
        .tower-level {
            position: absolute;
            bottom: -5px;
            right: -5px;
            background-color: #ff8f00;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .pea-shooter {
            background-color: #4caf50;
            color: #2e7d32;
        }
        
        .pepper-thrower {
            background-color: #f44336;
            color: #b71c1c;
        }
        
        .onion-guard {
            background-color: #ffeb3b;
            color: #f57f17;
        }
        
        .corn-cannon {
            background-color: #fff59d;
            color: #f9a825;
        }
        
        .potato-mine {
            background-color: #8d6e63;
            color: #4e342e;
        }
        
        .garlic-tower {
            background-color: #f8bbd0;
            color: #ad1457;
        }
        
        .cabbage-pult {
            background-color: #dce775;
            color: #827717;
        }
        
        .melon-pult {
            background-color: #a5d6a7;
            color: #2e7d32;
        }
        
        .sunflower {
            background-color: #fff176;
            color: #f57f17;
        }
        
        /* Êñ∞ÁÇÆÂè∞Ê†∑Âºè */
        .strawberry {
            background-color: #f44336;
            color: #c62828;
        }
        
        .pineapple {
            background-color: #ffeb3b;
            color: #f9a825;
        }
        
        .cactus {
            background-color: #4caf50;
            color: #2e7d32;
        }
        
        .mushroom {
            background-color: #7b1fa2;
            color: #4a148c;
        }
        
        .projectile {
            position: absolute;
            font-size: 20px;
            z-index: 4;
            transition: transform 0.1s linear;
        }
        
        .enemy {
            position: absolute;
            font-size: 30px;
            z-index: 3;
            transition: left 0.1s linear, top 0.1s linear;
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.3));
        }
        
        /* Êñ∞Êïå‰∫∫Ê†∑Âºè */
        .dragon {
            font-size: 40px;
            color: #d32f2f;
            z-index: 4;
            animation: flame 1s infinite alternate;
        }
        
        @keyframes flame {
            0% { text-shadow: 0 0 5px #ff5722; }
            100% { text-shadow: 0 0 15px #ff5722, 0 0 25px #ff9800; }
        }
        
        .wizard-rabbit {
            font-size: 35px;
            color: #7b1fa2;
            animation: pulse 1.5s infinite;
        }
        
        .armored-beetle {
            font-size: 32px;
            color: #455a64;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .toxic-snail {
            font-size: 34px;
            color: #7cb342;
            animation: toxic-pulse 2s infinite;
        }
        
        /* Âõ∞ÈöæÊ®°Âºè‰∏ìÂ±ûBOSS */
        .carrot-golem {
            font-size: 50px;
            color: #ff5722;
            z-index: 5;
            animation: golem-pulse 2s infinite;
        }
        
        @keyframes golem-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes toxic-pulse {
            0% { text-shadow: 0 0 5px #7cb342; }
            50% { text-shadow: 0 0 15px #7cb342; }
            100% { text-shadow: 0 0 5px #7cb342; }
        }
        
        #tower-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            max-width: 600px;
            padding: 15px;
            background-color: #f1f8e9;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .tower-option {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 25px;
            cursor: pointer;
            background-color: #c8e6c9;
            border: 3px solid #81c784;
            transition: transform 0.2s;
            position: relative;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        
        .tower-option:hover {
            transform: scale(1.1);
            background-color: #a5d6a7;
        }
        
        .tower-cost {
            position: absolute;
            bottom: -15px;
            font-size: 12px;
            background-color: #ff8f00;
            color: white;
            padding: 2px 5px;
            border-radius: 10px;
            min-width: 30px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .selected {
            border-color: #ff8f00;
            box-shadow: 0 0 10px #ff8f00;
        }
        
        .locked {
            opacity: 0.5;
            cursor: not-allowed;
            position: relative;
        }
        
        .locked::after {
            content: "üîí";
            position: absolute;
            bottom: -20px;
            font-size: 12px;
            left: 50%;
            transform: translateX(-50%);
            color: #d32f2f;
        }
        
        #game-info {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-bottom: 20px;
            background: linear-gradient(to right, #81c784, #66bb6a);
            padding: 10px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        #controls {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .game-button {
            background: linear-gradient(to bottom, #ff8f00, #f57c00);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            min-width: 140px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }
        
        .game-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }
        
        .game-button:active {
            transform: translateY(1px);
        }
        
        .game-button:disabled {
            background: linear-gradient(to bottom, #bdbdbd, #9e9e9e);
            cursor: not-allowed;
            transform: none;
        }
        
        #restart-button {
            background: linear-gradient(to bottom, #d32f2f, #b71c1c);
        }
        
        #handbook-button {
            background: linear-gradient(to bottom, #2196f3, #1976d2);
        }
        
        #difficulty-button {
            background: linear-gradient(to bottom, #9c27b0, #7b1fa2);
        }
        
        #pause-button {
            background: linear-gradient(to bottom, #607d8b, #455a64);
        }
        
        #achievements-button {
            background: linear-gradient(to bottom, #ff9800, #f57c00);
        }
        
        #message {
            margin-top: 10px;
            font-weight: bold;
            color: #d32f2f;
            min-height: 25px;
            padding: 8px 15px;
            background-color: #ffebee;
            border-radius: 20px;
            display: inline-block;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .health-bar {
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 100%;
            height: 5px;
            background-color: #ccc;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .health-fill {
            height: 100%;
            background: linear-gradient(to right, #4caf50, #8bc34a);
            width: 100%;
            transition: width 0.3s ease;
        }
        
        /* ÂõæÈâ¥Ê†∑Âºè */
        #handbook-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        #handbook-content {
            background-color: #f1f8e9;
            padding: 20px;
            border-radius: 15px;
            width: 80%;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .handbook-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .handbook-icon {
            font-size: 40px;
            margin-right: 15px;
            width: 60px;
            text-align: center;
        }
        
        .handbook-details {
            flex: 1;
        }
        
        .close-handbook {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f44336;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ÈöæÂ∫¶ÈÄâÊã©Ê†∑Âºè */
        #difficulty-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        #difficulty-content {
            background-color: #f1f8e9;
            padding: 20px;
            border-radius: 15px;
            width: 80%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .difficulty-option {
            background-color: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .difficulty-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
            background-color: #e3f2fd;
        }
        
        .difficulty-option.selected {
            background-color: #bbdefb;
            font-weight: bold;
            border-left: 5px solid #2196f3;
        }
        
        .difficulty-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #1976d2;
        }
        
        .difficulty-desc {
            font-size: 0.9em;
            color: #555;
        }
        
        /* ÊàêÂ∞±Ê†∑Âºè */
        #achievements-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        #achievements-content {
            background-color: #f1f8e9;
            padding: 20px;
            border-radius: 15px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .achievement-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        
        .achievement-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .achievement-icon {
            font-size: 30px;
            margin-right: 15px;
            width: 50px;
            text-align: center;
            color: #ff8f00;
        }
        
        .achievement-details {
            flex: 1;
        }
        
        .achievement-locked {
            opacity: 0.5;
            background-color: #f5f5f5;
        }
        
        .achievement-progress {
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }
        
        .achievement-reward {
            font-size: 0.9em;
            color: #4caf50;
            font-weight: bold;
            margin-top: 5px;
        }
        
        /* ÂçáÁ∫ßËèúÂçïÊ†∑Âºè */
        #upgrade-menu {
            display: none;
            position: absolute;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            padding: 10px;
            z-index: 20;
            width: 200px;
            border: 2px solid #81c784;
        }
        
        .upgrade-option {
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-weight: bold;
        }
        
        .upgrade-option:hover {
            background-color: #e8f5e9;
            transform: translateX(5px);
        }
        
        .upgrade-cost {
            float: right;
            color: #ff8f00;
            font-weight: bold;
        }
        
        .upgrade-separator {
            border-top: 1px solid #ddd;
            margin: 8px 0;
        }
        
        /* ÁâπÊÆäÊ≥¢Ê¨°ÊèêÁ§∫ */
        .special-wave {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ffeb3b, #ffc107);
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 24px;
            font-weight: bold;
            color: #d32f2f;
            z-index: 30;
            animation: pulse 1s infinite;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        /* Èü≥ÊïàÊéßÂà∂ */
        #sound-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(to bottom, #81c784, #66bb6a);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 50;
            transition: all 0.3s;
        }
        
        #sound-control:hover {
            transform: scale(1.1);
        }
        
        /* Èü≥ÈáèÊéßÂà∂ */
        #volume-control {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background-color: white;
            padding: 15px;
            border-radius: 25px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 50;
            display: none;
        }
        
        #volume-slider {
            width: 100px;
            height: 10px;
            -webkit-appearance: none;
            background: linear-gradient(to right, #81c784, #4caf50);
            border-radius: 5px;
            outline: none;
        }
        
        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ff8f00;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        /* Ê∏∏ÊàèËÉåÊôØË£ÖÈ•∞ */
        .decoration {
            position: absolute;
            font-size: 30px;
            opacity: 0.2;
            z-index: 1;
            animation: float 15s infinite linear;
        }
        
        @keyframes float {
            0% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-20px) translateX(20px); }
            50% { transform: translateY(0) translateX(40px); }
            75% { transform: translateY(20px) translateX(20px); }
            100% { transform: translateY(0) translateX(0); }
        }
        
        /* Êñ∞ÁÇÆÂè∞Ëß£ÈîÅÈÄöÁü• */
        .unlock-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #4caf50, #8bc34a);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: bold;
            z-index: 200;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: slideIn 0.5s forwards, fadeOut 0.5s 2.5s forwards;
        }
        
        @keyframes slideIn {
            from { top: -100px; }
            to { top: 20px; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; visibility: hidden; }
        }
        
        /* Ê∏∏ÊàèÊïôÁ®ãÊ†∑Âºè */
        #tutorial-modal {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }
        
        #tutorial-content {
            background-color: #f1f8e9;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .tutorial-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f44336;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .tutorial-step {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tutorial-step:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .tutorial-icon {
            font-size: 30px;
            margin-right: 15px;
            float: left;
        }
        
        .tutorial-text {
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1 id="game-title">ü•ï ËÉ°ËêùÂçúÂ°îÈò≤ ü•ï</h1>
        
        <div id="game-info">
            <div>ÁîüÂëΩ: <span id="lives">10</span></div>
            <div>ÈáëÂ∏Å: <span id="money">100</span></div>
            <div>Ê≥¢Êï∞: <span id="wave">0</span>/<span id="max-wave">0</span></div>
            <div>ÈöæÂ∫¶: <span id="difficulty">ÊôÆÈÄö</span></div>
            <div>ÊàêÂ∞±: <span id="achievement-count">0</span></div>
        </div>
        
        <div id="tower-selector">
            <div class="tower-option pea-shooter" title="Ë±åË±ÜÂ∞ÑÊâã - Ëä±Ë¥π: 30" onclick="selectTower('pea-shooter')">
                üå±
                <div class="tower-cost">30</div>
            </div>
            <div class="tower-option pepper-thrower" title="Ëæ£Ê§íÊäïÊâã - Ëä±Ë¥π: 50" onclick="selectTower('pepper-thrower')">
                üå∂Ô∏è
                <div class="tower-cost">50</div>
            </div>
            <div class="tower-option onion-guard" title="Ê¥ãËë±ÂÆàÂç´ - Ëä±Ë¥π: 40" onclick="selectTower('onion-guard')">
                üßÖ
                <div class="tower-cost">40</div>
            </div>
            <div class="tower-option corn-cannon" title="ÁéâÁ±≥ÁÇÆÂè∞ - Ëä±Ë¥π: 70" onclick="selectTower('corn-cannon')">
                üåΩ
                <div class="tower-cost">70</div>
            </div>
            <div class="tower-option potato-mine" title="ÂúüË±ÜÂú∞Èõ∑ - Ëä±Ë¥π: 60" onclick="selectTower('potato-mine')">
                ü•î
                <div class="tower-cost">60</div>
            </div>
            <div class="tower-option garlic-tower" title="Â§ßËíúÂ°î - Ëä±Ë¥π: 45" onclick="selectTower('garlic-tower')">
                üßÑ
                <div class="tower-cost">45</div>
            </div>
            <div class="tower-option cabbage-pult" title="Âç∑ÂøÉËèúÊäïÊâã - Ëä±Ë¥π: 55" onclick="selectTower('cabbage-pult')">
                ü•¨
                <div class="tower-cost">55</div>
            </div>
            <div class="tower-option melon-pult" title="Ë•øÁìúÊäïÊâã - Ëä±Ë¥π: 80" onclick="selectTower('melon-pult')">
                üçâ
                <div class="tower-cost">80</div>
            </div>
            <div class="tower-option sunflower" title="ÂêëÊó•Ëëµ - Ëä±Ë¥π: 25" onclick="selectTower('sunflower')">
                üåª
                <div class="tower-cost">25</div>
            </div>
            
            <!-- ÊàêÂ∞±Ëß£ÈîÅÁöÑÊñ∞ÁÇÆÂè∞ -->
            <div class="tower-option strawberry locked" title="ËçâËéìÂ∞ÑÊâã - Ëä±Ë¥π: 65 (ÊàêÂ∞±Ëß£ÈîÅ)" onclick="selectLockedTower('strawberry', 'Âª∫ÈÄ†10Â∫ßÈò≤Âæ°Â°î')">
                üçì
                <div class="tower-cost">65</div>
            </div>
            <div class="tower-option pineapple locked" title="Ëè†ËêùÁÇ∏Âºπ - Ëä±Ë¥π: 90 (ÊàêÂ∞±Ëß£ÈîÅ)" onclick="selectLockedTower('pineapple', 'Á¥ØËÆ°Ëé∑Âæó1000ÈáëÂ∏Å')">
                üçç
                <div class="tower-cost">90</div>
            </div>
            <div class="tower-option cactus locked" title="‰ªô‰∫∫ÊéåÂ∞ÑÊâã - Ëä±Ë¥π: 70 (ÊàêÂ∞±Ëß£ÈîÅ)" onclick="selectLockedTower('cactus', 'Âõ∞ÈöæÊ®°ÂºèÂÆåÊàê15Ê≥¢')">
                üåµ
                <div class="tower-cost">70</div>
            </div>
            <div class="tower-option mushroom locked" title="ËòëËèá‰∫ë - Ëä±Ë¥π: 100 (ÊàêÂ∞±Ëß£ÈîÅ)" onclick="selectLockedTower('mushroom', 'ÂáªË¥•100‰∏™Êïå‰∫∫')">
                ‚òÅÔ∏è
                <div class="tower-cost">100</div>
            </div>
        </div>
        
        <div id="game-board">
            <div id="carrot">ü•ï</div>
            <!-- Êñ∞ÁöÑËúøËúíË∑ØÂæÑ -->
            <div class="path" id="path1"></div>
            <div class="path" id="path2"></div>
            <div class="path" id="path3"></div>
            <div class="path" id="path4"></div>
            <div class="path" id="path5"></div>
            <div class="path" id="path6"></div>
            <div class="path" id="path7"></div>
            <div class="path" id="path8"></div>
            <div class="path" id="path9"></div>
            
            <!-- ËÉåÊôØË£ÖÈ•∞ -->
            <div class="decoration" style="top: 50px; left: 100px;">üåø</div>
            <div class="decoration" style="top: 150px; left: 500px; animation-delay: -5s;">üçÉ</div>
            <div class="decoration" style="top: 300px; left: 200px; animation-delay: -10s;">üå±</div>
        </div>
        
        <div id="controls">
            <button id="start-button" class="game-button" onclick="startWave()">ÂºÄÂßãÊ≥¢Ê¨°</button>
            <button id="pause-button" class="game-button" onclick="togglePause()">ÊöÇÂÅú</button>
            <button id="restart-button" class="game-button" onclick="restartGame()">ÈáçÊñ∞ÂºÄÂßã</button>
            <button id="handbook-button" class="game-button" onclick="openHandbook()">ÂõæÈâ¥</button>
            <button id="achievements-button" class="game-button" onclick="openAchievements()">ÊàêÂ∞±</button>
            <button id="difficulty-button" class="game-button" onclick="openDifficultyModal()">ÈöæÂ∫¶</button>
        </div>
        
        <div id="message"></div>
    </div>

    <!-- Ê∏∏ÊàèÊïôÁ®ãÊ®°ÊÄÅÊ°Ü -->
    <div id="tutorial-modal">
        <div id="tutorial-content">
            <button class="tutorial-close" onclick="closeTutorial()">√ó</button>
            <h2>Ê∏∏ÊàèÁé©Ê≥ïÊåáÂçó</h2>
            
            <div class="tutorial-step">
                <div class="tutorial-icon">üéØ</div>
                <div class="tutorial-text">
                    <h3>Ê∏∏ÊàèÁõÆÊ†á</h3>
                    <p>‰øùÊä§ËÉ°ËêùÂçúü•ï‰∏çË¢´Êïå‰∫∫ÂêÉÊéâÔºÅÂª∫ÈÄ†Èò≤Âæ°Â°îÊù•ÈòªÊ≠¢Êïå‰∫∫Ê≤øÁùÄË∑ØÂæÑÂâçËøõ„ÄÇÊØèÊ≥¢Êïå‰∫∫‰ºöË∂äÊù•Ë∂äÂº∫ÔºåÂ∞ΩÂèØËÉΩÂùöÊåÅÊõ¥Â§öÊ≥¢Ê¨°ÔºÅ</p>
                </div>
            </div>
            
            <div class="tutorial-step">
                <div class="tutorial-icon">üèóÔ∏è</div>
                <div class="tutorial-text">
                    <h3>Âª∫ÈÄ†Èò≤Âæ°Â°î</h3>
                    <p>ÁÇπÂáª‰∏äÊñπÁöÑÈò≤Âæ°Â°îÂõæÊ†áÈÄâÊã©Á±ªÂûãÔºåÁÑ∂ÂêéÂú®Ê∏∏ÊàèÂå∫ÂüüÁÇπÂáªÊîæÁΩÆ„ÄÇÊØèÁßçÈò≤Âæ°Â°îÊúâ‰∏çÂêåÁöÑÊîªÂáªÊñπÂºèÂíåÁâπÊÄß„ÄÇ</p>
                    <p>ÂêëÊó•Ëëµüåª‰∏çÊîªÂáªÊïå‰∫∫Ôºå‰ΩÜ‰ºöÂÆöÊúü‰∫ßÁîüÈáëÂ∏Å„ÄÇ</p>
                </div>
            </div>
            
            <div class="tutorial-step">
                <div class="tutorial-icon">‚öîÔ∏è</div>
                <div class="tutorial-text">
                    <h3>Êïå‰∫∫Á±ªÂûã</h3>
                    <p>Êïå‰∫∫‰ºöÊ≤øÁùÄË∑ØÂæÑÂâçËøõÔºå‰∏çÂêåÁ±ªÂûãÊïå‰∫∫Êúâ‰∏çÂêåÁöÑÁâπÊÄßÔºö</p>
                    <p>üêáÂÖîÂ≠êÈÄüÂ∫¶Âø´ÔºåüêåËúóÁâõÁîüÂëΩÂÄºÈ´òÔºåüê¶È∏üÊòØÈ£ûË°åÂçï‰ΩçÂè™ËÉΩË¢´ÁâπÂÆöÂ°îÊîªÂáªÔºåü¶ÇËùéÂ≠êÂèØ‰ª•ÊöÇÊó∂Á¶ÅÁî®Èò≤Âæ°Â°î„ÄÇ</p>
                </div>
            </div>
            
            <div class="tutorial-step">
                <div class="tutorial-icon">‚¨ÜÔ∏è</div>
                <div class="tutorial-text">
                    <h3>ÂçáÁ∫ßÁ≥ªÁªü</h3>
                    <p>ÁÇπÂáªÂ∑≤ÊîæÁΩÆÁöÑÈò≤Âæ°Â°îÂèØ‰ª•ÊâìÂºÄÂçáÁ∫ßËèúÂçïÔºåÂçáÁ∫ßÂèØ‰ª•ÊèêÈ´òÊîªÂáªÂäõ„ÄÅÂ∞ÑÁ®ãÁ≠âÂ±ûÊÄß„ÄÇ</p>
                    <p>‰Ω†‰πüÂèØ‰ª•Âá∫ÂîÆÈò≤Âæ°Â°îËé∑ÂæóÈÉ®ÂàÜÈáëÂ∏ÅËøîËøò„ÄÇ</p>
                </div>
            </div>
            
            <div class="tutorial-step">
                <div class="tutorial-icon">üèÜ</div>
                <div class="tutorial-text">
                    <h3>ÊàêÂ∞±Á≥ªÁªü</h3>
                    <p>ÂÆåÊàêÁâπÂÆöÁõÆÊ†áÂèØ‰ª•Ëß£ÈîÅÊàêÂ∞±ÔºåÊúâ‰∫õÊàêÂ∞±Ëøò‰ºöËß£ÈîÅÊñ∞ÁöÑÈò≤Âæ°Â°îÁ±ªÂûãÔºÅ</p>
                    <p>Êü•Áúã"ÊàêÂ∞±"ÊåâÈíÆ‰∫ÜËß£ÂÖ∑‰ΩìËß£ÈîÅÊù°‰ª∂„ÄÇ</p>
                </div>
            </div>
            
            <button class="game-button" onclick="closeTutorial()" style="width: 100%; margin-top: 20px;">ÂºÄÂßãÊ∏∏Êàè</button>
        </div>
    </div>

    <!-- ÂõæÈâ¥Ê®°ÊÄÅÊ°Ü -->
    <div id="handbook-modal">
        <div id="handbook-content">
            <button class="close-handbook" onclick="closeHandbook()">√ó</button>
            <h2>Ê∏∏ÊàèÂõæÈâ¥</h2>
            
            <div id="handbook-items">
                <!-- Èò≤Âæ°Â°îÂíåÊïå‰∫∫Â∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÊ∑ªÂä† -->
            </div>
        </div>
    </div>

    <!-- ÈöæÂ∫¶ÈÄâÊã©Ê®°ÊÄÅÊ°Ü -->
    <div id="difficulty-modal">
        <div id="difficulty-content">
            <h2>ÈÄâÊã©Ê∏∏ÊàèÈöæÂ∫¶</h2>
            
            <div class="difficulty-option" onclick="setDifficulty('easy')">
                <div class="difficulty-title">ÁÆÄÂçïÊ®°Âºè</div>
                <div class="difficulty-desc">Êïå‰∫∫ËæÉÂº±ÔºåÈÄÇÂêàÊñ∞ÊâãÁé©ÂÆ∂</div>
            </div>
            
            <div class="difficulty-option selected" onclick="setDifficulty('normal')">
                <div class="difficulty-title">ÊôÆÈÄöÊ®°Âºè</div>
                <div class="difficulty-desc">Ê†áÂáÜÈöæÂ∫¶ÔºåÂπ≥Ë°°ÁöÑÊ∏∏Êàè‰ΩìÈ™å</div>
            </div>
            
            <div class="difficulty-option" onclick="setDifficulty('hard')">
                <div class="difficulty-title">Âõ∞ÈöæÊ®°Âºè</div>
                <div class="difficulty-desc">Êïå‰∫∫Êõ¥Âº∫ÔºåÈÄÇÂêàÊåëÊàòËá™ÊàëÁöÑÁé©ÂÆ∂</div>
            </div>
            
            <button class="game-button" onclick="closeDifficultyModal()" style="width: 100%; margin-top: 20px;">Á°ÆËÆ§</button>
        </div>
    </div>

    <!-- ÊàêÂ∞±Ê®°ÊÄÅÊ°Ü -->
    <div id="achievements-modal">
        <div id="achievements-content">
            <h2>Ê∏∏ÊàèÊàêÂ∞±</h2>
            
            <div id="achievements-list">
                <!-- ÊàêÂ∞±Â∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÊ∑ªÂä† -->
            </div>
            
            <button class="game-button" onclick="closeAchievements()" style="width: 100%; margin-top: 20px;">ÂÖ≥Èó≠</button>
        </div>
    </div>

    <!-- ÂçáÁ∫ßËèúÂçï -->
    <div id="upgrade-menu">
        <div id="upgrade-options">
            <!-- ÂçáÁ∫ßÈÄâÈ°πÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÊ∑ªÂä† -->
        </div>
        <div class="upgrade-separator"></div>
        <div class="upgrade-option" onclick="sellTower()">Âá∫ÂîÆ (<span id="sell-value">0</span>ÈáëÂ∏Å)</div>
    </div>

    <!-- Èü≥ÊïàÊéßÂà∂ÊåâÈíÆ -->
    <button id="sound-control" onclick="toggleSound()">üîä</button>
    
    <!-- Èü≥ÈáèÊéßÂà∂ -->
    <div id="volume-control">
        <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="0.3">
    </div>

    <script>
        // Ê∏∏ÊàèÂèòÈáè
        let selectedTowerType = null;
        let towers = [];
        let enemies = [];
        let projectiles = [];
        let money = 100;
        let lives = 10;
        let wave = 0;
        let maxWave = 0;
        let gameRunning = false;
        let gamePaused = false;
        let towerElements = [];
        let enemyElements = [];
        let projectileElements = [];
        let difficulty = 'normal';
        let sunflowerInterval;
        let soundEnabled = true;
        let achievements = [];
        let selectedTowerForUpgrade = null;
        let unlockedTowers = {
            'strawberry': false,
            'pineapple': false,
            'cactus': false,
            'mushroom': false
        };
        
        // Èü≥Êïà
        const sounds = {
            placeTower: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-positive-interface-beep-221.mp3'),
            enemyDefeated: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-explosion-2759.mp3'),
            towerAttack: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-short-laser-gun-shot-1670.mp3'),
            gameOver: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-retro-arcade-lose-2027.mp3'),
            waveStart: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3'),
            upgrade: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3'),
            click: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3'),
            sell: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-cash-register-printing-receipt-2583.mp3'),
            unlock: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-game-level-completed-2059.mp3')
        };
        
        // ÂàùÂßãÂåñÈü≥Êïà
        Object.values(sounds).forEach(sound => {
            sound.volume = 0.3;
        });
        
        // ÈöæÂ∫¶ËÆæÁΩÆ
        const difficultySettings = {
            easy: { 
                enemyHealthMultiplier: 0.8,
                enemySpeedMultiplier: 0.9,
                startingMoney: 150,
                startingLives: 15,
                rewardMultiplier: 1.2,
                towerCostMultiplier: 0.9,
                upgradeCostMultiplier: 0.8
            },
            normal: { 
                enemyHealthMultiplier: 1,
                enemySpeedMultiplier: 1,
                startingMoney: 100,
                startingLives: 10,
                rewardMultiplier: 1,
                towerCostMultiplier: 1,
                upgradeCostMultiplier: 1
            },
            hard: { 
                enemyHealthMultiplier: 1.3,
                enemySpeedMultiplier: 1.2,
                startingMoney: 70,
                startingLives: 7,
                rewardMultiplier: 0.8,
                towerCostMultiplier: 1.1,
                upgradeCostMultiplier: 1.2
            }
        };
        
        // Â°îÈò≤Êï∞ÊçÆ
        const towerData = {
            'pea-shooter': { 
                name: 'Ë±åË±ÜÂ∞ÑÊâã',
                cost: 30, 
                damage: 10, 
                range: 150, 
                cooldown: 1000, 
                emoji: 'üå±',
                damagePerLevel: 2,
                rangePerLevel: 10,
                upgradeCost: 20
            },
            'pepper-thrower': { 
                name: 'Ëæ£Ê§íÊäïÊâã',
                cost: 50, 
                damage: 25, 
                range: 120, 
                cooldown: 1500, 
                emoji: 'üå∂Ô∏è',
                damagePerLevel: 5,
                rangePerLevel: 5,
                upgradeCost: 30
            },
            'onion-guard': { 
                name: 'Ê¥ãËë±ÂÆàÂç´',
                cost: 40, 
                damage: 5, 
                range: 100, 
                cooldown: 800, 
                emoji: 'üßÖ',
                damagePerLevel: 1,
                rangePerLevel: 5,
                upgradeCost: 25
            },
            'corn-cannon': { 
                name: 'ÁéâÁ±≥ÁÇÆÂè∞',
                cost: 70, 
                damage: 40, 
                range: 180, 
                cooldown: 2000, 
                emoji: 'üåΩ',
                damagePerLevel: 8,
                rangePerLevel: 10,
                upgradeCost: 40
            },
            'potato-mine': { 
                name: 'ÂúüË±ÜÂú∞Èõ∑',
                cost: 60, 
                damage: 100, 
                range: 0, 
                cooldown: 0, 
                emoji: 'ü•î', 
                isMine: true,
                damagePerLevel: 20,
                upgradeCost: 35
            },
            'garlic-tower': { 
                name: 'Â§ßËíúÂ°î',
                cost: 45, 
                damage: 8, 
                range: 90, 
                cooldown: 1200, 
                emoji: 'üßÑ', 
                stunDuration: 500,
                damagePerLevel: 2,
                rangePerLevel: 5,
                upgradeCost: 25,
                stunPerLevel: 100
            },
            'cabbage-pult': { 
                name: 'Âç∑ÂøÉËèúÊäïÊâã',
                cost: 55, 
                damage: 15, 
                range: 140, 
                cooldown: 1500, 
                emoji: 'ü•¨', 
                critChance: 0.3,
                damagePerLevel: 3,
                rangePerLevel: 5,
                upgradeCost: 30,
                critPerLevel: 0.05
            },
            'melon-pult': { 
                name: 'Ë•øÁìúÊäïÊâã',
                cost: 80, 
                damage: 35, 
                range: 160, 
                cooldown: 2000, 
                emoji: 'üçâ', 
                splashRadius: 50,
                damagePerLevel: 7,
                rangePerLevel: 5,
                upgradeCost: 45,
                splashPerLevel: 5
            },
            'sunflower': { 
                name: 'ÂêëÊó•Ëëµ',
                cost: 25, 
                damage: 0, 
                range: 0, 
                cooldown: 0, 
                emoji: 'üåª', 
                income: 5, 
                incomeInterval: 10000,
                incomePerLevel: 1,
                upgradeCost: 15
            },
            // Êñ∞ÁÇÆÂè∞Êï∞ÊçÆ
            'strawberry': { 
                name: 'ËçâËéìÂ∞ÑÊâã',
                cost: 65, 
                damage: 18, 
                range: 140, 
                cooldown: 1200, 
                emoji: 'üçì',
                damagePerLevel: 4,
                rangePerLevel: 10,
                upgradeCost: 35,
                poisonChance: 0.4,
                poisonDuration: 3000,
                poisonDamage: 3,
                poisonPerLevel: 0.05
            },
            'pineapple': { 
                name: 'Ëè†ËêùÁÇ∏Âºπ',
                cost: 90, 
                damage: 60, 
                range: 130, 
                cooldown: 2500, 
                emoji: 'üçç',
                damagePerLevel: 12,
                rangePerLevel: 5,
                upgradeCost: 50,
                splashRadius: 70,
                splashPerLevel: 5
            },
            'cactus': { 
                name: '‰ªô‰∫∫ÊéåÂ∞ÑÊâã',
                cost: 70, 
                damage: 15, 
                range: 180, 
                cooldown: 700, 
                emoji: 'üåµ',
                damagePerLevel: 3,
                rangePerLevel: 10,
                upgradeCost: 40,
                pierceChance: 0.3,
                piercePerLevel: 0.05
            },
            'mushroom': { 
                name: 'ËòëËèá‰∫ë',
                cost: 100, 
                damage: 80, 
                range: 200, 
                cooldown: 3000, 
                emoji: '‚òÅÔ∏è',
                damagePerLevel: 15,
                rangePerLevel: 10,
                upgradeCost: 60,
                splashRadius: 100,
                slowEffect: 0.5,
                slowDuration: 3000,
                slowPerLevel: 0.05
            }
        };
        
        // Êïå‰∫∫Êï∞ÊçÆ
        const enemyData = {
            'üêõ': { name: 'ËöúËô´', health: 30, speed: 1, reward: 5, desc: 'Âü∫Á°ÄÊïå‰∫∫ÔºåÊï∞ÈáèÂ§ö' },
            'üêá': { name: 'ÂÖîÂ≠ê', health: 50, speed: 2, reward: 10, desc: 'ÁßªÂä®ÈÄüÂ∫¶Âø´' },
            'üêÄ': { name: 'ËÄÅÈº†', health: 80, speed: 0.8, reward: 15, desc: 'ÁîüÂëΩÂÄºËæÉÈ´ò' },
            'üê¶': { name: 'È∏ü', health: 60, speed: 1.5, reward: 12, desc: 'È£ûË°åÂçï‰ΩçÔºåÂè™ËÉΩË¢´ÁâπÂÆöÂ°îÊîªÂáª' },
            'üêå': { name: 'ËúóÁâõ', health: 120, speed: 0.5, reward: 20, desc: 'ÁîüÂëΩÂÄºÂæàÈ´ò' },
            'ü¶ó': { name: 'ËùóËô´', health: 40, speed: 2.5, reward: 8, desc: 'ÁßªÂä®ÈÄüÂ∫¶ÊûÅÂø´' },
            'ü¶é': { name: 'Ëú•Ëú¥', health: 70, speed: 1.2, reward: 14, desc: 'ÊúâÂá†ÁéáÈó™ÈÅøÊîªÂáª' },
            'üêù': { name: 'ËúúËúÇ', health: 45, speed: 1.8, reward: 10, desc: 'È£ûË°åÂçï‰ΩçÔºåÂè™ËÉΩË¢´ÁâπÂÆöÂ°îÊîªÂáª' },
            'üêú': { name: 'ËöÇËöÅ', health: 25, speed: 1.3, reward: 5, desc: 'ÊàêÁæ§Âá∫Áé∞' },
            'ü¶Ç': { name: 'ËùéÂ≠ê', health: 90, speed: 0.7, reward: 18, desc: 'ÂèØ‰ª•ÊöÇÊó∂Á¶ÅÁî®Èò≤Âæ°Â°î' },
            'üê≤': { name: 'Â∑®Èæô', health: 200, speed: 1.2, reward: 50, desc: 'È£ûË°åÂçï‰ΩçÔºåÂØπÈò≤Âæ°Â°îÈÄ†ÊàêÈ¢ùÂ§ñ‰º§ÂÆ≥' },
            'üßô': { name: 'È≠îÊ≥ïÂÖî', health: 100, speed: 0.8, reward: 25, desc: 'Âè¨Âî§Â∞èÂÖîÂàÜË∫´ÔºåÈôç‰ΩéÈôÑËøëÈò≤Âæ°Â°îÊîªÂáªÈÄüÂ∫¶' },
            'üõ°Ô∏è': { name: 'Ë£ÖÁî≤Ëô´', health: 150, speed: 0.6, reward: 30, desc: 'È´òÈò≤Âæ°ÔºåÂáèÂ∞ëÂèóÂà∞ÁöÑ‰º§ÂÆ≥' },
            'üß™': { name: 'ÊØíÊ∂≤ËúóÁâõ', health: 90, speed: 0.4, reward: 20, desc: 'Áïô‰∏ãÊØíÊ∂≤Ë∑ØÂæÑÔºåÂØπÁªèËøáÁöÑÊïå‰∫∫Êèê‰æõÂ¢ûÁõä' },
            'ü•ï': { name: 'ËÉ°ËêùÂçúÂ∑®‰∫∫', health: 500, speed: 0.3, reward: 100, desc: 'ÂÖçÁñ´ÂáèÈÄüÂíåÁú©ÊôïÔºåÂØπËÉ°ËêùÂçúÈÄ†Êàê3ÂÄç‰º§ÂÆ≥' }
        };
        
        // Êñ∞ÁöÑÊïå‰∫∫Ë°åËøõË∑ØÂæÑÔºàÊõ¥ËúøËúíÔºâ
        const path = [
            { x: 50, y: 115 },     // Ëµ∑ÁÇπ
            { x: 150, y: 115 },    // Á¨¨‰∏ÄÊÆµ
            { x: 150, y: 165 },    // Á¨¨‰∏Ä‰∏™ËΩ¨ÂºØ
            { x: 250, y: 165 },    // Á¨¨‰∫åÊÆµ
            { x: 250, y: 215 },    // Á¨¨‰∫å‰∏™ËΩ¨ÂºØ
            { x: 350, y: 215 },    // Á¨¨‰∏âÊÆµ
            { x: 350, y: 265 },    // Á¨¨‰∏â‰∏™ËΩ¨ÂºØ
            { x: 450, y: 265 },    // Á¨¨ÂõõÊÆµ
            { x: 450, y: 315 },    // Á¨¨Âõõ‰∏™ËΩ¨ÂºØ
            { x: 550, y: 315 }     // ÁªàÁÇπÔºàËÉ°ËêùÂçú‰ΩçÁΩÆÔºâ
        ];
        
        // ÊàêÂ∞±Á≥ªÁªü
        const achievementData = [
            { id: 'first_blood', name: 'Á¨¨‰∏ÄÊª¥Ë°Ä', description: 'ÂáªË¥•Á¨¨‰∏Ä‰∏™Êïå‰∫∫', icon: 'ü©∏', condition: (game) => game.enemiesDefeated >= 1, unlockTower: null },
            { id: 'tower_master', name: 'Â°îÈò≤Â§ßÂ∏à', description: 'Âª∫ÈÄ†10Â∫ßÈò≤Âæ°Â°î', icon: 'üè∞', condition: (game) => game.towersBuilt >= 10, unlockTower: 'strawberry' },
            { id: 'wave_10', name: 'ÂçÅÊ≥¢ÊåëÊàò', description: 'ÂÆåÊàêÁ¨¨10Ê≥¢', icon: 'üîü', condition: (game) => game.wave >= 10, unlockTower: null },
            { id: 'wave_20', name: '‰∫åÂçÅÊ≥¢ÊåëÊàò', description: 'ÂÆåÊàêÁ¨¨20Ê≥¢', icon: '2Ô∏è‚É£0Ô∏è‚É£', condition: (game) => game.wave >= 20, unlockTower: null },
            { id: 'rich', name: 'ÂØåÂèØÊïåÂõΩ', description: 'Á¥ØËÆ°Ëé∑Âæó1000ÈáëÂ∏Å', icon: 'üí∞', condition: (game) => game.totalMoneyEarned >= 1000, unlockTower: 'pineapple' },
            { id: 'sunflower_field', name: 'ÂêëÊó•ËëµÁî∞', description: 'Âª∫ÈÄ†5‰∏™ÂêëÊó•Ëëµ', icon: 'üåª', condition: (game) => game.sunflowersBuilt >= 5, unlockTower: null },
            { id: 'perfectionist', name: 'ÂÆåÁæé‰∏ª‰πâËÄÖ', description: 'ÂÆåÊàê‰∏ÄÊ≥¢ËÄå‰∏çÊçüÂ§±ÁîüÂëΩ', icon: 'üíØ', condition: (game) => game.perfectWaves >= 1, unlockTower: null },
            { id: 'speed_runner', name: 'ÈÄüÈÄöÁé©ÂÆ∂', description: 'Âú®5ÂàÜÈíüÂÜÖÂÆåÊàê10Ê≥¢', icon: '‚è±Ô∏è', condition: (game) => game.wave >= 10 && game.gameTime < 300000, unlockTower: null },
            { id: 'hard_mode', name: 'Á°¨Ê†∏Áé©ÂÆ∂', description: 'Âú®Âõ∞ÈöæÊ®°Âºè‰∏ãÂÆåÊàê15Ê≥¢', icon: 'üíÄ', condition: (game) => game.wave >= 15 && game.difficulty === 'hard', unlockTower: 'cactus' },
            { id: 'upgrade_king', name: 'ÂçáÁ∫ß‰πãÁéã', description: 'ÂçáÁ∫ß10Ê¨°Èò≤Âæ°Â°î', icon: '‚¨ÜÔ∏è', condition: (game) => game.towersUpgraded >= 10, unlockTower: null },
            { id: 'enemy_slayer', name: 'Êïå‰∫∫ÊùÄÊâã', description: 'ÂáªË¥•100‰∏™Êïå‰∫∫', icon: '‚öîÔ∏è', condition: (game) => game.enemiesDefeated >= 100, unlockTower: 'mushroom' },
            { id: 'boss_slayer', name: 'BOSSÊùÄÊâã', description: 'ÂáªË¥•ËÉ°ËêùÂçúÂ∑®‰∫∫', icon: 'ü•ï', condition: (game) => game.bossesDefeated >= 1, unlockTower: null }
        ];
        
        // Ê∏∏ÊàèÁªüËÆ°
        const gameStats = {
            enemiesDefeated: 0,
            towersBuilt: 0,
            totalMoneyEarned: 100,
            sunflowersBuilt: 0,
            perfectWaves: 0,
            gameTime: 0,
            difficulty: 'normal',
            towersUpgraded: 0,
            achievementsUnlocked: 0,
            bossesDefeated: 0
        };
        
        // ÂàùÂßãÂåñÊ∏∏Êàè
        function initGame() {
            // Ê∏ÖÈô§ÊâÄÊúâÊ∏∏ÊàèÂÖÉÁ¥†
            clearGameElements();
            
            // ÈáçÁΩÆÊ∏∏ÊàèÁä∂ÊÄÅ
            selectedTowerType = null;
            towers = [];
            enemies = [];
            projectiles = [];
            money = difficultySettings[difficulty].startingMoney;
            lives = difficultySettings[difficulty].startingLives;
            wave = 0;
            gameRunning = false;
            gamePaused = false;
            gameStats.gameTime = 0;
            
            // ÈáçÁΩÆÊ∏∏ÊàèÁªüËÆ°
            gameStats.enemiesDefeated = 0;
            gameStats.towersBuilt = 0;
            gameStats.totalMoneyEarned = difficultySettings[difficulty].startingMoney;
            gameStats.sunflowersBuilt = 0;
            gameStats.perfectWaves = 0;
            gameStats.towersUpgraded = 0;
            gameStats.difficulty = difficulty;
            gameStats.achievementsUnlocked = 0;
            gameStats.bossesDefeated = 0;
            achievements = [];
            
            // ÈáçÁΩÆËß£ÈîÅÁöÑÁÇÆÂè∞
            unlockedTowers = {
                'strawberry': false,
                'pineapple': false,
                'cactus': false,
                'mushroom': false
            };
            updateTowerSelector();
            
            // Ê∏ÖÈô§ÂêëÊó•ËëµÊî∂ÂÖ•Èó¥Èöî
            if (sunflowerInterval) {
                clearInterval(sunflowerInterval);
                sunflowerInterval = null;
            }
            
            // Êõ¥Êñ∞UI
            updateGameInfo();
            document.getElementById('start-button').disabled = false;
            document.getElementById('pause-button').textContent = 'ÊöÇÂÅú';
            document.querySelectorAll('.tower-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            showMessage("Ê∏∏ÊàèÂ∑≤ÂáÜÂ§áÂ∞±Áª™! ÈÄâÊã©Èò≤Âæ°Â°îÂºÄÂßãÊ∏∏Êàè");
            
            // Êí≠ÊîæÁÇπÂáªÈü≥Êïà
            playSound('click');
        }
        
        // Ê∏ÖÈô§ÊâÄÊúâÊ∏∏ÊàèÂÖÉÁ¥†
        function clearGameElements() {
            // Ê∏ÖÈô§ÊâÄÊúâÂ°î
            towerElements.forEach(el => {
                if (el.parentNode) {
                    el.parentNode.removeChild(el);
                }
            });
            towerElements = [];
            
            // Ê∏ÖÈô§ÊâÄÊúâÊïå‰∫∫
            enemyElements.forEach(el => {
                if (el.parentNode) {
                    el.parentNode.removeChild(el);
                }
            });
            enemyElements = [];
            
            // Ê∏ÖÈô§ÊâÄÊúâÊäïÂ∞ÑÁâ©
            projectileElements.forEach(el => {
                if (el.parentNode) {
                    el.parentNode.removeChild(el);
                }
            });
            projectileElements = [];
            
            // Ê∏ÖÈô§Ê∏∏ÊàèÂæ™ÁéØ
            if (window.gameLoop) {
                clearInterval(window.gameLoop);
                window.gameLoop = null;
            }
        }
        
        // ÈáçÊñ∞ÂºÄÂßãÊ∏∏Êàè
        function restartGame() {
            if (confirm("Á°ÆÂÆöË¶ÅÈáçÊñ∞ÂºÄÂßãÊ∏∏ÊàèÂêóÔºüÂΩìÂâçËøõÂ∫¶Â∞Ü‰∏¢Â§±„ÄÇ")) {
                playSound('click');
                initGame();
            }
        }
        
        // ÊâìÂºÄÂõæÈâ¥
        function openHandbook() {
            const container = document.getElementById('handbook-items');
            container.innerHTML = '';
            
            // Ê∑ªÂä†Èò≤Âæ°Â°î‰ø°ÊÅØ
            Object.keys(towerData).forEach(type => {
                const tower = towerData[type];
                const item = document.createElement('div');
                item.className = 'handbook-item';
                
                item.innerHTML = `
                    <div class="handbook-icon">${tower.emoji}</div>
                    <div class="handbook-details">
                        <h4>${tower.name}</h4>
                        <p><strong>Ëä±Ë¥π:</strong> ${getTowerCost(type)}ÈáëÂ∏Å</p>
                        <p><strong>‰º§ÂÆ≥:</strong> ${tower.damage} (+${tower.damagePerLevel}/Á∫ß)</p>
                        ${tower.range ? `<p><strong>Â∞ÑÁ®ã:</strong> ${tower.range} (+${tower.rangePerLevel}/Á∫ß)</p>` : ''}
                        <p><strong>ÁâπÊÄß:</strong> ${getTowerDescription(type)}</p>
                    </div>
                `;
                
                container.appendChild(item);
            });
            
            // Ê∑ªÂä†Êïå‰∫∫‰ø°ÊÅØ
            Object.keys(enemyData).forEach(type => {
                const enemy = enemyData[type];
                const item = document.createElement('div');
                item.className = 'handbook-item';
                
                item.innerHTML = `
                    <div class="handbook-icon">${type}</div>
                    <div class="handbook-details">
                        <h4>${enemy.name}</h4>
                        <p><strong>ÁîüÂëΩÂÄº:</strong> ${enemy.health} (ÈöèÊ≥¢Êï∞Â¢ûÂä†)</p>
                        <p><strong>ÈÄüÂ∫¶:</strong> ${enemy.speed}</p>
                        <p><strong>Â•ñÂä±:</strong> ${enemy.reward}ÈáëÂ∏Å</p>
                        <p><strong>ÁâπÊÄß:</strong> ${enemy.desc}</p>
                    </div>
                `;
                
                container.appendChild(item);
            });
            
            document.getElementById('handbook-modal').style.display = 'flex';
            playSound('click');
        }
        
        // Ëé∑ÂèñÈò≤Âæ°Â°îÊèèËø∞
        function getTowerDescription(type) {
            const tower = towerData[type];
            let desc = '';
            
            if (type === 'pea-shooter') desc = 'Âü∫Á°ÄÊîªÂáªÂ°îÔºåÂèëÂ∞ÑË±åË±ÜËøõË°åÁõ¥Á∫øÊîªÂáª';
            else if (type === 'pepper-thrower') desc = 'È´ò‰º§ÂÆ≥‰ΩÜÊîªÂáªÈÄüÂ∫¶ÊÖ¢';
            else if (type === 'onion-guard') desc = 'ÊîªÂáªÈÄüÂ∫¶Âø´‰ΩÜ‰º§ÂÆ≥‰Ωé';
            else if (type === 'corn-cannon') desc = 'Ë∂ÖËøúÂ∞ÑÁ®ã‰ΩÜÊîªÂáªÈÄüÂ∫¶ÂæàÊÖ¢';
            else if (type === 'potato-mine') desc = 'ÊîæÁΩÆÂêé3ÁßíÊøÄÊ¥ªÔºåÊïå‰∫∫Êé•ËøëÊó∂ÁàÜÁÇ∏';
            else if (type === 'garlic-tower') desc = 'ÊúâÂá†ÁéáÁú©ÊôïÊïå‰∫∫';
            else if (type === 'cabbage-pult') desc = 'ÊúâÂá†ÁéáÈÄ†ÊàêÊö¥Âáª‰º§ÂÆ≥';
            else if (type === 'melon-pult') desc = 'ÈÄ†ÊàêËåÉÂõ¥Ê∫ÖÂ∞Ñ‰º§ÂÆ≥';
            else if (type === 'sunflower') desc = 'ÊØè10Áßí‰∫ßÁîü5ÈáëÂ∏Å (+1/Á∫ß)';
            else if (type === 'strawberry') desc = 'ÂèëÂ∞ÑËçâËéìÔºåÊúâÂá†Áéá‰ΩøÊïå‰∫∫‰∏≠ÊØíÔºàÊåÅÁª≠‰º§ÂÆ≥Ôºâ';
            else if (type === 'pineapple') desc = 'ÊäïÊé∑Ëè†ËêùÈÄ†ÊàêÂ§ßËåÉÂõ¥ÁàÜÁÇ∏‰º§ÂÆ≥';
            else if (type === 'cactus') desc = 'ÂèØ‰ª•ÊîªÂáªÈ£ûË°åÂíåÂú∞Èù¢Âçï‰ΩçÔºåÊúâÂá†ÁéáÁ©øÈÄèÊïå‰∫∫';
            else if (type === 'mushroom') desc = 'ÂèëÂ∞ÑËòëËèá‰∫ëÔºåÈÄ†ÊàêÂ∑®Â§ßËåÉÂõ¥‰º§ÂÆ≥Âπ∂ÂáèÈÄüÊïå‰∫∫';
            
            return desc;
        }
        
        // ÂÖ≥Èó≠ÂõæÈâ¥
        function closeHandbook() {
            document.getElementById('handbook-modal').style.display = 'none';
            playSound('click');
        }
        
        // ÊâìÂºÄÊàêÂ∞±
        function openAchievements() {
            const list = document.getElementById('achievements-list');
            list.innerHTML = '';
            
            achievementData.forEach(ach => {
                const achieved = achievements.includes(ach.id);
                const progress = ach.condition(gameStats);
                
                const item = document.createElement('div');
                item.className = `achievement-item ${achieved ? '' : 'achievement-locked'}`;
                
                let rewardText = '';
                if (ach.unlockTower) {
                    rewardText = `<div class="achievement-reward">Ëß£ÈîÅ: ${towerData[ach.unlockTower].name} ${towerData[ach.unlockTower].emoji}</div>`;
                }
                
                item.innerHTML = `
                    <div class="achievement-icon">${ach.icon}</div>
                    <div class="achievement-details">
                        <h4>${ach.name}</h4>
                        <p>${ach.description}</p>
                        ${rewardText}
                        ${!achieved && typeof progress === 'number' ? 
                            `<div class="achievement-progress">ËøõÂ∫¶: ${Math.min(100, Math.round(progress * 100))}%</div>` : ''}
                    </div>
                `;
                
                list.appendChild(item);
            });
            
            document.getElementById('achievements-modal').style.display = 'flex';
            playSound('click');
        }
        
        // ÂÖ≥Èó≠ÊàêÂ∞±
        function closeAchievements() {
            document.getElementById('achievements-modal').style.display = 'none';
            playSound('click');
        }
        
        // ÊâìÂºÄÈöæÂ∫¶ÈÄâÊã©
        function openDifficultyModal() {
            document.getElementById('difficulty-modal').style.display = 'flex';
            // Êõ¥Êñ∞ÂΩìÂâçÈÄâÊã©ÁöÑÈöæÂ∫¶
            document.querySelectorAll('.difficulty-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`.difficulty-option:nth-child(${
                difficulty === 'easy' ? 1 : difficulty === 'normal' ? 2 : 3
            })`).classList.add('selected');
            playSound('click');
        }
        
        // ÂÖ≥Èó≠ÈöæÂ∫¶ÈÄâÊã©
        function closeDifficultyModal() {
            document.getElementById('difficulty-modal').style.display = 'none';
            playSound('click');
        }
        
        // ÂÖ≥Èó≠ÊïôÁ®ã
        function closeTutorial() {
            document.getElementById('tutorial-modal').style.display = 'none';
            playSound('click');
        }
        
        // ËÆæÁΩÆÈöæÂ∫¶
        function setDifficulty(level) {
            difficulty = level;
            document.getElementById('difficulty').textContent = 
                level === 'easy' ? 'ÁÆÄÂçï' : level === 'normal' ? 'ÊôÆÈÄö' : 'Âõ∞Èöæ';
            gameStats.difficulty = level;
            closeDifficultyModal();
            initGame();
        }
        
        // ÈÄâÊã©Èò≤Âæ°Â°î
        function selectTower(type) {
            selectedTowerType = type;
            document.querySelectorAll('.tower-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`.tower-option.${type}`).classList.add('selected');
            showMessage(`Â∑≤ÈÄâÊã©: ${towerData[type].name} (Ëä±Ë¥π: ${getTowerCost(type)})`);
            playSound('click');
        }
        
        // ÈÄâÊã©ÈîÅÂÆöÁöÑÈò≤Âæ°Â°î
        function selectLockedTower(type, condition) {
            showMessage(`ÈúÄË¶ÅËß£ÈîÅ: ${condition}`);
            playSound('click');
        }
        
        // Êõ¥Êñ∞ÁÇÆÂè∞ÈÄâÊã©Âô®ÊòæÁ§∫
        function updateTowerSelector() {
            document.querySelectorAll('.tower-option').forEach(opt => {
                const type = opt.classList[1];
                if (unlockedTowers[type]) {
                    opt.classList.remove('locked');
                    opt.onclick = function() { selectTower(type); };
                    opt.title = `${towerData[type].name} - Ëä±Ë¥π: ${getTowerCost(type)}`;
                }
            });
        }
        
        // Ëé∑ÂèñÈò≤Âæ°Â°îÊàêÊú¨ÔºàËÄÉËôëÈöæÂ∫¶Ôºâ
        function getTowerCost(type) {
            return Math.round(towerData[type].cost * difficultySettings[difficulty].towerCostMultiplier);
        }
        
        // Ëé∑ÂèñÂçáÁ∫ßÊàêÊú¨ÔºàËÄÉËôëÈöæÂ∫¶Ôºâ
        function getUpgradeCost(type, level) {
            return Math.round(towerData[type].upgradeCost * difficultySettings[difficulty].upgradeCostMultiplier * level);
        }
        
        // Ëé∑ÂèñÈò≤Âæ°Â°îÂêçÁß∞
        function getTowerName(type) {
            return towerData[type]?.name || type;
        }
        
        // ÊîæÁΩÆÈò≤Âæ°Â°î
        document.getElementById('game-board').addEventListener('click', function(e) {
            if (!selectedTowerType || gameRunning || gamePaused) return;
            
            const rect = this.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Ê£ÄÊü•ÊòØÂê¶Âú®Ë∑ØÂæÑ‰∏ä
            if (isOnPath(x, y)) {
                showMessage("‰∏çËÉΩÂú®Ë∑ØÂæÑ‰∏äÊîæÁΩÆÈò≤Âæ°Â°î!");
                return;
            }
            
            // Ê£ÄÊü•ÊòØÂê¶ÊúâË∂≥Â§üÁöÑÈáëÂ∏Å
            const cost = getTowerCost(selectedTowerType);
            if (money < cost) {
                showMessage("ÈáëÂ∏Å‰∏çË∂≥!");
                return;
            }
            
            // Ê£ÄÊü•ÊòØÂê¶‰∏éÂÖ∂‰ªñÂ°îÈáçÂè†
            for (const tower of towers) {
                const dx = tower.x - x;
                const dy = tower.y - y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                if (distance < 40) {
                    showMessage("ËøôÈáåÂ∑≤ÁªèÊúâ‰∏Ä‰∏™Èò≤Âæ°Â°î‰∫Ü!");
                    return;
                }
            }
            
            // Ê£ÄÊü•ÊòØÂê¶Á¶ªËÉ°ËêùÂçúÂ§™Ëøë
            const carrotRect = document.getElementById('carrot').getBoundingClientRect();
            const carrotX = carrotRect.left - rect.left + carrotRect.width / 2;
            const carrotY = carrotRect.top - rect.top + carrotRect.height / 2;
            const distanceToCarrot = Math.sqrt(Math.pow(x - carrotX, 2) + Math.pow(y - carrotY, 2));
            if (distanceToCarrot < 60) {
                showMessage("‰∏çËÉΩÊääÈò≤Âæ°Â°îÊîæÂú®ËÉ°ËêùÂçúÊóÅËæπ!");
                return;
            }
            
            // Ê£ÄÊü•ÊòØÂê¶Á¶ªËæπÁïåÂ§™Ëøë
            if (x < 30 || x > 570 || y < 30 || y > 370) {
                showMessage("‰∏çËÉΩÊääÈò≤Âæ°Â°îÊîæÂú®Â§™Èù†ËøëËæπÁºòÁöÑ‰ΩçÁΩÆ!");
                return;
            }
            
            // ÂàõÂª∫Èò≤Âæ°Â°î
            const tower = {
                type: selectedTowerType,
                x: x,
                y: y,
                level: 1,
                cooldown: 0,
                emoji: towerData[selectedTowerType].emoji,
                isMine: towerData[selectedTowerType].isMine || false,
                mineActive: false,
                stunDuration: towerData[selectedTowerType].stunDuration || 0,
                critChance: towerData[selectedTowerType].critChance || 0,
                splashRadius: towerData[selectedTowerType].splashRadius || 0,
                income: towerData[selectedTowerType].income || 0,
                incomeInterval: towerData[selectedTowerType].incomeInterval || 0,
                lastIncomeTime: 0,
                disableTimer: 0,
                damage: towerData[selectedTowerType].damage,
                range: towerData[selectedTowerType].range,
                // Êñ∞ÁÇÆÂè∞ÁâπÊúâÂ±ûÊÄß
                poisonChance: towerData[selectedTowerType].poisonChance || 0,
                poisonDuration: towerData[selectedTowerType].poisonDuration || 0,
                poisonDamage: towerData[selectedTowerType].poisonDamage || 0,
                pierceChance: towerData[selectedTowerType].pierceChance || 0,
                slowEffect: towerData[selectedTowerType].slowEffect || 0,
                slowDuration: towerData[selectedTowerType].slowDuration || 0
            };
            
            towers.push(tower);
            money -= cost;
            gameStats.towersBuilt++;
            gameStats.totalMoneyEarned += cost;
            
            if (selectedTowerType === 'sunflower') {
                gameStats.sunflowersBuilt++;
            }
            
            updateGameInfo();
            checkAchievements();
            
            // Âú®È°µÈù¢‰∏äÊòæÁ§∫Èò≤Âæ°Â°î
            const towerElement = document.createElement('div');
            towerElement.className = `tower ${selectedTowerType}`;
            towerElement.style.left = `${x-25}px`;
            towerElement.style.top = `${y-25}px`;
            towerElement.textContent = towerData[selectedTowerType].emoji;
            
            // Ê∑ªÂä†Á≠âÁ∫ßÊ†áÁ≠æ
            const levelElement = document.createElement('div');
            levelElement.className = 'tower-level';
            levelElement.textContent = tower.level;
            towerElement.appendChild(levelElement);
            
            // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂Áî®‰∫éÂçáÁ∫ß
            towerElement.addEventListener('click', function(e) {
                e.stopPropagation();
                if (gameRunning || gamePaused) return;
                openUpgradeMenu(tower, towerElement);
            });
            
            document.getElementById('game-board').appendChild(towerElement);
            tower.element = towerElement;
            tower.levelElement = levelElement;
            towerElements.push(towerElement);
            
            // Â¶ÇÊûúÊòØÂú∞Èõ∑ÔºåÊòæÁ§∫‰∏çÂêåÁöÑÁä∂ÊÄÅ
            if (tower.isMine) {
                towerElement.textContent = '‚è≥';
                tower.mineTimer = setTimeout(() => {
                    tower.mineActive = true;
                    towerElement.textContent = 'üí£';
                }, 3000);
            }
            
            // Â¶ÇÊûúÊòØÂêëÊó•ËëµÔºåÂºÄÂßã‰∫ßÁîüÊî∂ÂÖ•
            if (tower.type === 'sunflower' && !sunflowerInterval) {
                sunflowerInterval = setInterval(produceIncome, 1000);
            }
            
            showMessage(`${getTowerName(selectedTowerType)} Â∑≤ÊîæÁΩÆ!`);
            playSound('placeTower');
        });
        
        // Ê£ÄÊü•ÁÇπÊòØÂê¶Âú®Ë∑ØÂæÑ‰∏ä
        function isOnPath(x, y) {
            // Ê£ÄÊü•ÊâÄÊúâË∑ØÂæÑÊÆµ
            const paths = [
                { x1: 50, y1: 100, x2: 150, y2: 130 },   // Á¨¨‰∏ÄÊÆµÊ∞¥Âπ≥Ë∑ØÂæÑ
                { x1: 150, y1: 100, x2: 180, y2: 150 },   // Á¨¨‰∏ÄÊÆµÂûÇÁõ¥Ë∑ØÂæÑ
                { x1: 150, y1: 150, x2: 250, y2: 180 },   // Á¨¨‰∫åÊÆµÊ∞¥Âπ≥Ë∑ØÂæÑ
                { x1: 250, y1: 150, x2: 280, y2: 200 },   // Á¨¨‰∫åÊÆµÂûÇÁõ¥Ë∑ØÂæÑ
                { x1: 250, y1: 200, x2: 350, y2: 230 },   // Á¨¨‰∏âÊÆµÊ∞¥Âπ≥Ë∑ØÂæÑ
                { x1: 350, y1: 200, x2: 380, y2: 250 },   // Á¨¨‰∏âÊÆµÂûÇÁõ¥Ë∑ØÂæÑ
                { x1: 350, y1: 250, x2: 450, y2: 280 },   // Á¨¨ÂõõÊÆµÊ∞¥Âπ≥Ë∑ØÂæÑ
                { x1: 450, y1: 250, x2: 480, y2: 300 },   // Á¨¨ÂõõÊÆµÂûÇÁõ¥Ë∑ØÂæÑ
                { x1: 450, y1: 300, x2: 550, y2: 330 }    // Á¨¨‰∫îÊÆµÊ∞¥Âπ≥Ë∑ØÂæÑ
            ];
            
            for (const path of paths) {
                if (x >= path.x1 && x <= path.x2 && y >= path.y1 && y <= path.y2) {
                    return true;
                }
            }
            return false;
        }
        
        // ÊâìÂºÄÂçáÁ∫ßËèúÂçï
        function openUpgradeMenu(tower, element) {
            closeUpgradeMenu(); // ÂÖ≥Èó≠‰ªª‰ΩïÂ∑≤ÊâìÂºÄÁöÑÂçáÁ∫ßËèúÂçï
            
            selectedTowerForUpgrade = tower;
            
            const menu = document.getElementById('upgrade-menu');
            const options = document.getElementById('upgrade-options');
            options.innerHTML = '';
            
            // ËÆæÁΩÆÂá∫ÂîÆ‰ª∑ÂÄºÔºàÂéü‰ª∑ÁöÑ75%Ôºâ
            const sellValue = Math.round(getTowerCost(tower.type) * 0.75 * tower.level);
            document.getElementById('sell-value').textContent = sellValue;
            
            // Ê∑ªÂä†ÂçáÁ∫ßÈÄâÈ°π
            if (!tower.isMine) {
                const upgradeCost = getUpgradeCost(tower.type, tower.level);
                const upgradeOption = document.createElement('div');
                upgradeOption.className = 'upgrade-option';
                upgradeOption.innerHTML = `ÂçáÁ∫ßÂà∞Á≠âÁ∫ß ${tower.level + 1} <span class="upgrade-cost">${upgradeCost}ÈáëÂ∏Å</span>`;
                upgradeOption.onclick = function() {
                    if (money >= upgradeCost) {
                        upgradeTower(tower, upgradeCost);
                    } else {
                        showMessage("ÈáëÂ∏Å‰∏çË∂≥!");
                    }
                };
                options.appendChild(upgradeOption);
            }
            
            // ÂÆö‰ΩçËèúÂçï
            menu.style.display = 'block';
            const boardRect = document.getElementById('game-board').getBoundingClientRect();
            const x = tower.x + boardRect.left;
            const y = tower.y + boardRect.top;
            
            // Á°Æ‰øùËèúÂçï‰∏ç‰ºöË∂ÖÂá∫Ê∏∏ÊàèÂå∫Âüü
            let left = x + 30;
            let top = y - 20;
            
            if (left + 200 > window.innerWidth) {
                left = window.innerWidth - 220;
            }
            
            if (top + 100 > window.innerHeight) {
                top = window.innerHeight - 120;
            }
            
            menu.style.left = `${left}px`;
            menu.style.top = `${top}px`;
            
            // ÁÇπÂáªÂÖ∂‰ªñÂú∞ÊñπÂÖ≥Èó≠ËèúÂçï
            setTimeout(() => {
                document.addEventListener('click', closeUpgradeMenu);
            }, 10);
        }
        
        // ÂÖ≥Èó≠ÂçáÁ∫ßËèúÂçï
        function closeUpgradeMenu() {
            document.getElementById('upgrade-menu').style.display = 'none';
            document.removeEventListener('click', closeUpgradeMenu);
            selectedTowerForUpgrade = null;
        }
        
        // ÂçáÁ∫ßÈò≤Âæ°Â°î
        function upgradeTower(tower, cost) {
            money -= cost;
            gameStats.totalMoneyEarned += cost;
            tower.level++;
            gameStats.towersUpgraded++;
            
            // Êõ¥Êñ∞Â±ûÊÄß
            tower.damage = towerData[tower.type].damage + (towerData[tower.type].damagePerLevel * (tower.level - 1));
            if (towerData[tower.type].rangePerLevel) {
                tower.range = towerData[tower.type].range + (towerData[tower.type].rangePerLevel * (tower.level - 1));
            }
            if (towerData[tower.type].incomePerLevel) {
                tower.income = towerData[tower.type].income + (towerData[tower.type].incomePerLevel * (tower.level - 1));
            }
            if (towerData[tower.type].stunPerLevel) {
                tower.stunDuration = towerData[tower.type].stunDuration + (towerData[tower.type].stunPerLevel * (tower.level - 1));
            }
            if (towerData[tower.type].critPerLevel) {
                tower.critChance = towerData[tower.type].critChance + (towerData[tower.type].critPerLevel * (tower.level - 1));
            }
            if (towerData[tower.type].splashPerLevel) {
                tower.splashRadius = towerData[tower.type].splashRadius + (towerData[tower.type].splashPerLevel * (tower.level - 1));
            }
            if (towerData[tower.type].poisonPerLevel) {
                tower.poisonChance = towerData[tower.type].poisonChance + (towerData[tower.type].poisonPerLevel * (tower.level - 1));
            }
            if (towerData[tower.type].piercePerLevel) {
                tower.pierceChance = towerData[tower.type].pierceChance + (towerData[tower.type].piercePerLevel * (tower.level - 1));
            }
            if (towerData[tower.type].slowPerLevel) {
                tower.slowEffect = towerData[tower.type].slowEffect + (towerData[tower.type].slowPerLevel * (tower.level - 1));
            }
            
            // Êõ¥Êñ∞Á≠âÁ∫ßÊòæÁ§∫
            tower.levelElement.textContent = tower.level;
            
            updateGameInfo();
            closeUpgradeMenu();
            showMessage(`${getTowerName(tower.type)} Â∑≤ÂçáÁ∫ßÂà∞Á≠âÁ∫ß ${tower.level}!`);
            playSound('upgrade');
            checkAchievements();
        }
        
        // Âá∫ÂîÆÈò≤Âæ°Â°î
        function sellTower() {
            if (!selectedTowerForUpgrade) return;
            
            const tower = selectedTowerForUpgrade;
            const sellValue = Math.round(getTowerCost(tower.type) * 0.75 * tower.level);
            
            // ÁßªÈô§Â°î
            const index = towers.indexOf(tower);
            if (index !== -1) {
                towers.splice(index, 1);
            }
            
            // ÁßªÈô§ÂÖÉÁ¥†
            if (tower.element.parentNode) {
                tower.element.parentNode.removeChild(tower.element);
            }
            
            // Â¶ÇÊûúÊòØÂú∞Èõ∑‰∏îËÆ°Êó∂Âô®Â≠òÂú®ÔºåÊ∏ÖÈô§ËÆ°Êó∂Âô®
            if (tower.isMine && tower.mineTimer) {
                clearTimeout(tower.mineTimer);
            }
            
            money += sellValue;
            gameStats.totalMoneyEarned += sellValue;
            updateGameInfo();
            closeUpgradeMenu();
            showMessage(`Â∑≤Âá∫ÂîÆ ${getTowerName(tower.type)} Ëé∑Âæó ${sellValue}ÈáëÂ∏Å!`);
            playSound('sell');
            
            // Ê£ÄÊü•ÊòØÂê¶ËøòÊúâÂêëÊó•Ëëµ
            const hasSunflowers = towers.some(t => t.type === 'sunflower');
            if (!hasSunflowers && sunflowerInterval) {
                clearInterval(sunflowerInterval);
                sunflowerInterval = null;
            }
        }
        
        // ÂêëÊó•Ëëµ‰∫ßÁîüÊî∂ÂÖ•
        function produceIncome() {
            const now = Date.now();
            let incomeGenerated = false;
            
            towers.forEach(tower => {
                if (tower.type === 'sunflower' && now - tower.lastIncomeTime >= tower.incomeInterval) {
                    money += tower.income;
                    gameStats.totalMoneyEarned += tower.income;
                    tower.lastIncomeTime = now;
                    incomeGenerated = true;
                    
                    // ÊòæÁ§∫Êî∂ÂÖ•Âä®Áîª
                    const incomeText = document.createElement('div');
                    incomeText.textContent = `+${tower.income}`;
                    incomeText.style.position = 'absolute';
                    incomeText.style.left = `${tower.x-10}px`;
                    incomeText.style.top = `${tower.y-30}px`;
                    incomeText.style.color = 'gold';
                    incomeText.style.fontWeight = 'bold';
                    incomeText.style.fontSize = '20px';
                    incomeText.style.zIndex = '10';
                    document.getElementById('game-board').appendChild(incomeText);
                    
                    setTimeout(() => {
                        incomeText.style.top = `${tower.y-50}px`;
                        incomeText.style.opacity = '0';
                        setTimeout(() => {
                            incomeText.remove();
                        }, 500);
                    }, 100);
                }
            });
            
            if (incomeGenerated) {
                updateGameInfo();
                checkAchievements();
            }
        }
        
        // ÂºÄÂßãÊ≥¢Ê¨°
        function startWave() {
            if (gameRunning || gamePaused) return;
            
            wave++;
            if (wave > maxWave) {
                maxWave = wave;
            }
            
            updateGameInfo();
            gameRunning = true;
            document.getElementById('start-button').disabled = true;
            showMessage(`Á¨¨ ${wave} Ê≥¢ÂºÄÂßã!`);
            playSound('waveStart');
            
            // ÁâπÊÆäÊ≥¢Ê¨°ÊèêÁ§∫
            if (wave % 5 === 0) {
                const specialWave = document.createElement('div');
                specialWave.className = 'special-wave';
                specialWave.textContent = `ÁâπÊÆäÊ≥¢Ê¨° ${wave}!`;
                document.getElementById('game-board').appendChild(specialWave);
                
                setTimeout(() => {
                    specialWave.remove();
                }, 2000);
            }
            
            // ÁîüÊàêÊïå‰∫∫
            let enemyCount = 5 + Math.floor(wave * 1.5);
            
            // ÁâπÊÆäÊ≥¢Ê¨°ÊúâÊõ¥Â§öÊïå‰∫∫
            if (wave % 5 === 0) {
                enemyCount = Math.floor(enemyCount * 1.5);
            }
            
            // Âõ∞ÈöæÊ®°Âºè20Ê≥¢ÂêéÂá∫Áé∞ËÉ°ËêùÂçúÂ∑®‰∫∫
            if (difficulty === 'hard' && wave >= 20 && Math.random() < 0.3) {
                setTimeout(() => {
                    if (lives <= 0 || gamePaused) return;
                    createEnemy('ü•ï'); // ËÉ°ËêùÂçúÂ∑®‰∫∫
                }, 2000);
                enemyCount = Math.floor(enemyCount * 0.7); // ÂáèÂ∞ëÊôÆÈÄöÊïå‰∫∫Êï∞Èáè
            }
            
            for (let i = 0; i < enemyCount; i++) {
                setTimeout(() => {
                    if (lives <= 0 || gamePaused) return;
                    createEnemy();
                }, i * 1000);
            }
            
            // Ê£ÄÊü•Ê≥¢Ê¨°ÊòØÂê¶ÁªìÊùü
            setTimeout(() => {
                gameRunning = false;
                document.getElementById('start-button').disabled = false;
                
                if (lives > 0) {
                    const waveBonus = Math.round((20 + wave * 5) * difficultySettings[difficulty].rewardMultiplier);
                    showMessage(`Á¨¨ ${wave} Ê≥¢ÁªìÊùü! Ëé∑Âæó ${waveBonus}ÈáëÂ∏ÅÂ•ñÂä±`);
                    money += waveBonus;
                    gameStats.totalMoneyEarned += waveBonus;
                    
                    // Ê£ÄÊü•ÊòØÂê¶ÂÆåÁæéÊ≥¢Ê¨°ÔºàÊó†ÁîüÂëΩÊçüÂ§±Ôºâ
                    if (lives === difficultySettings[difficulty].startingLives) {
                        gameStats.perfectWaves++;
                        checkAchievements();
                    }
                    
                    updateGameInfo();
                    checkAchievements();
                }
            }, enemyCount * 1000 + 2000);
            
            // ÂºÄÂßãÊ∏∏ÊàèÂæ™ÁéØ
            if (!window.gameLoop) {
                window.gameLoop = setInterval(updateGame, 16);
            }
        }
        
        // ÊöÇÂÅú/ÁªßÁª≠Ê∏∏Êàè
        function togglePause() {
            gamePaused = !gamePaused;
            
            if (gamePaused) {
                document.getElementById('pause-button').textContent = 'ÁªßÁª≠';
                showMessage("Ê∏∏ÊàèÂ∑≤ÊöÇÂÅú");
            } else {
                document.getElementById('pause-button').textContent = 'ÊöÇÂÅú';
                showMessage("Ê∏∏ÊàèÂ∑≤ÁªßÁª≠");
            }
            
            playSound('click');
        }
        
        // ÂàáÊç¢Èü≥Êïà
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('sound-control').textContent = soundEnabled ? 'üîä' : 'üîá';
            document.getElementById('volume-control').style.display = soundEnabled ? 'block' : 'none';
            playSound('click');
        }
        
        // Ë∞ÉÊï¥Èü≥Èáè
        document.getElementById('volume-slider').addEventListener('input', function() {
            const volume = parseFloat(this.value);
            Object.values(sounds).forEach(sound => {
                sound.volume = volume;
            });
        });
        
        // ÂàõÂª∫Êïå‰∫∫
        function createEnemy(specificType) {
            const enemyTypes = ['üêõ', 'üêõ', 'üêõ', 'üêá', 'üêá', 'üêÄ', 'üê¶', 'üêå', 'ü¶ó', 'ü¶é', 'üêù', 'üêú', 'ü¶Ç'];
            let enemyType = specificType || enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
            
            // ÈöèÁùÄÊ≥¢Êï∞Â¢ûÂä†ÔºåÂá∫Áé∞Êõ¥Âº∫Êïå‰∫∫ÁöÑÊ¶ÇÁéáÂ¢ûÂä†
            if (!specificType && Math.random() < wave * 0.05) {
                enemyType = ['üêÄ', 'üê¶', 'üêå', 'ü¶é', 'ü¶Ç'][Math.floor(Math.random() * 5)];
            }
            
            // ÂêéÊúüÂá∫Áé∞Êñ∞Êïå‰∫∫
            if (!specificType && wave >= 8 && Math.random() < 0.1) {
                enemyType = 'üß™'; // ÊØíÊ∂≤ËúóÁâõ
            }
            if (!specificType && wave >= 10 && Math.random() < 0.1) {
                enemyType = 'üõ°Ô∏è'; // Ë£ÖÁî≤Ëô´
            }
            if (!specificType && wave >= 12 && Math.random() < 0.1) {
                enemyType = 'üßô'; // È≠îÊ≥ïÂÖî
            }
            if (!specificType && wave >= 15 && Math.random() < 0.1) {
                enemyType = 'üê≤'; // Â∑®Èæô
            }
            
            // ÁâπÊÆäÊ≥¢Ê¨°ÂèØËÉΩÂá∫Áé∞ÁâπÊÆäÊïå‰∫∫
            if (!specificType && wave % 5 === 0) {
                if (Math.random() < 0.3) {
                    enemyType = Math.random() < 0.5 ? 'üê∫' : 'ü¶Ö';
                }
            }
            
            // ËöÇËöÅÊàêÁæ§Âá∫Áé∞
            if (!specificType && enemyType === 'üêú') {
                const antCount = 3 + Math.floor(Math.random() * 3);
                for (let i = 0; i < antCount; i++) {
                    setTimeout(() => createSingleEnemy('üêú'), i * 300);
                }
                return;
            }
            
            createSingleEnemy(enemyType);
        }
        
        // ÂàõÂª∫Âçï‰∏™Êïå‰∫∫
        function createSingleEnemy(enemyType) {
            let health, speed, reward, bossDamageMultiplier = 1;
            const settings = difficultySettings[difficulty];
            
            switch(enemyType) {
                case 'üêõ':
                    health = Math.round((30 + wave * 5) * settings.enemyHealthMultiplier);
                    speed = 1 * settings.enemySpeedMultiplier;
                    reward = 5;
                    break;
                case 'üêá':
                    health = Math.round((50 + wave * 8) * settings.enemyHealthMultiplier);
                    speed = 2 * settings.enemySpeedMultiplier;
                    reward = 10;
                    break;
                case 'üêÄ':
                    health = Math.round((80 + wave * 12) * settings.enemyHealthMultiplier);
                    speed = 0.8 * settings.enemySpeedMultiplier;
                    reward = 15;
                    break;
                case 'üê¶':
                    health = Math.round((60 + wave * 10) * settings.enemyHealthMultiplier);
                    speed = 1.5 * settings.enemySpeedMultiplier;
                    reward = 12;
                    break;
                case 'üêå':
                    health = Math.round((120 + wave * 15) * settings.enemyHealthMultiplier);
                    speed = 0.5 * settings.enemySpeedMultiplier;
                    reward = 20;
                    break;
                case 'ü¶ó':
                    health = Math.round((40 + wave * 6) * settings.enemyHealthMultiplier);
                    speed = 2.5 * settings.enemySpeedMultiplier;
                    reward = 8;
                    break;
                case 'ü¶é':
                    health = Math.round((70 + wave * 10) * settings.enemyHealthMultiplier);
                    speed = 1.2 * settings.enemySpeedMultiplier;
                    reward = 14;
                    break;
                case 'üêù':
                    health = Math.round((45 + wave * 7) * settings.enemyHealthMultiplier);
                    speed = 1.8 * settings.enemySpeedMultiplier;
                    reward = 10;
                    break;
                case 'üêú':
                    health = Math.round((25 + wave * 4) * settings.enemyHealthMultiplier);
                    speed = 1.3 * settings.enemySpeedMultiplier;
                    reward = 5;
                    break;
                case 'ü¶Ç':
                    health = Math.round((90 + wave * 13) * settings.enemyHealthMultiplier);
                    speed = 0.7 * settings.enemySpeedMultiplier;
                    reward = 18;
                    break;
                case 'üê∫': // ÁâπÊÆäÊïå‰∫∫ - Áãº
                    health = Math.round((150 + wave * 20) * settings.enemyHealthMultiplier);
                    speed = 1.5 * settings.enemySpeedMultiplier;
                    reward = 25;
                    bossDamageMultiplier = 2.5; // BOSSÂØπËÉ°ËêùÂçúÈÄ†Êàê2.5ÂÄç‰º§ÂÆ≥
                    break;
                case 'ü¶Ö': // ÁâπÊÆäÊïå‰∫∫ - ËÄÅÈπ∞
                    health = Math.round((100 + wave * 15) * settings.enemyHealthMultiplier);
                    speed = 2 * settings.enemySpeedMultiplier;
                    reward = 30;
                    bossDamageMultiplier = 2.5; // BOSSÂØπËÉ°ËêùÂçúÈÄ†Êàê2.5ÂÄç‰º§ÂÆ≥
                    break;
                // Êñ∞Êïå‰∫∫
                case 'üê≤': // Â∑®Èæô
                    health = Math.round((200 + wave * 25) * settings.enemyHealthMultiplier);
                    speed = 1.2 * settings.enemySpeedMultiplier;
                    reward = 50;
                    break;
                case 'üßô': // È≠îÊ≥ïÂÖî
                    health = Math.round((100 + wave * 15) * settings.enemyHealthMultiplier);
                    speed = 0.8 * settings.enemySpeedMultiplier;
                    reward = 25;
                    break;
                case 'üõ°Ô∏è': // Ë£ÖÁî≤Ëô´
                    health = Math.round((150 + wave * 20) * settings.enemyHealthMultiplier);
                    speed = 0.6 * settings.enemySpeedMultiplier;
                    reward = 30;
                    break;
                case 'üß™': // ÊØíÊ∂≤ËúóÁâõ
                    health = Math.round((90 + wave * 12) * settings.enemyHealthMultiplier);
                    speed = 0.4 * settings.enemySpeedMultiplier;
                    reward = 20;
                    break;
                case 'ü•ï': // ËÉ°ËêùÂçúÂ∑®‰∫∫ (Âõ∞ÈöæÊ®°Âºè‰∏ìÂ±ûBOSS)
                    health = Math.round((500 + wave * 30) * settings.enemyHealthMultiplier);
                    speed = 0.3 * settings.enemySpeedMultiplier;
                    reward = 100;
                    bossDamageMultiplier = 3; // ÂØπËÉ°ËêùÂçúÈÄ†Êàê3ÂÄç‰º§ÂÆ≥
                    break;
            }
            
            const enemy = {
                type: enemyType,
                x: path[0].x,
                y: path[0].y,
                health: health,
                maxHealth: health,
                speed: speed,
                reward: reward,
                pathIndex: 0,
                element: null,
                isFlying: enemyType === 'üê¶' || enemyType === 'üêù' || enemyType === 'ü¶Ö' || enemyType === 'üê≤',
                stunTimer: 0,
                dodgeChance: enemyType === 'ü¶é' ? 0.2 : 0,
                canDisableTowers: enemyType === 'ü¶Ç' || enemyType === 'üê≤',
                disableTimer: 0,
                isBoss: enemyType === 'üê∫' || enemyType === 'ü¶Ö' || enemyType === 'ü•ï',
                bossDamageMultiplier: bossDamageMultiplier, // BOSS‰º§ÂÆ≥ÂÄçÊï∞
                originalSpeed: speed,
                // Êñ∞Êïå‰∫∫ÁâπÊúâÂ±ûÊÄß
                isArmored: enemyType === 'üõ°Ô∏è',
                armor: enemyType === 'üõ°Ô∏è' ? 0.3 : 0, // ÂáèÂ∞ë30%‰º§ÂÆ≥
                isToxic: enemyType === 'üß™',
                summonMinions: enemyType === 'üßô',
                minionCooldown: 0,
                // ËÉ°ËêùÂçúÂ∑®‰∫∫ÁâπÊúâÂ±ûÊÄß
                isGolem: enemyType === 'ü•ï',
                immuneToSlow: enemyType === 'ü•ï',
                immuneToStun: enemyType === 'ü•ï'
            };
            
            enemies.push(enemy);
            
            // Âú®È°µÈù¢‰∏äÊòæÁ§∫Êïå‰∫∫
            const enemyElement = document.createElement('div');
            enemyElement.className = `enemy ${enemyType}`;
            enemyElement.textContent = enemyType;
            
            // Â¶ÇÊûúÊòØBOSSÊïå‰∫∫ÔºåÊîæÂ§ßÊòæÁ§∫
            if (enemy.isBoss) {
                enemyElement.style.fontSize = '40px';
                enemyElement.style.zIndex = '4';
                
                // ËÉ°ËêùÂçúÂ∑®‰∫∫Êõ¥Â§ß
                if (enemyType === 'ü•ï') {
                    enemyElement.style.fontSize = '50px';
                    enemyElement.style.zIndex = '5';
                    enemyElement.classList.add('carrot-golem');
                    
                    // ÊòæÁ§∫BOSSË≠¶Âëä
                    const bossWarning = document.createElement('div');
                    bossWarning.className = 'special-wave';
                    bossWarning.textContent = 'ËÉ°ËêùÂçúÂ∑®‰∫∫Âá∫Áé∞!';
                    bossWarning.style.backgroundColor = 'rgba(255, 87, 34, 0.8)';
                    document.getElementById('game-board').appendChild(bossWarning);
                    
                    setTimeout(() => {
                        bossWarning.remove();
                    }, 3000);
                }
            }
            
            enemyElement.style.left = `${enemy.x-15}px`;
            enemyElement.style.top = `${enemy.y-15}px`;
            
            // Ê∑ªÂä†Ë°ÄÊù°
            const healthBar = document.createElement('div');
            healthBar.className = 'health-bar';
            const healthFill = document.createElement('div');
            healthFill.className = 'health-fill';
            healthBar.appendChild(healthFill);
            enemyElement.appendChild(healthBar);
            
            document.getElementById('game-board').appendChild(enemyElement);
            enemy.element = enemyElement;
            enemy.healthFill = healthFill;
            enemyElements.push(enemyElement);
        }
        
        // Êõ¥Êñ∞Ê∏∏ÊàèÁä∂ÊÄÅ
        function updateGame() {
            if (gamePaused) return;
            
            gameStats.gameTime += 16;
            
            // Êõ¥Êñ∞Êïå‰∫∫‰ΩçÁΩÆ
            enemies.forEach(enemy => {
                // Â¶ÇÊûúÊïå‰∫∫Ë¢´Áú©ÊôïÔºåË∑≥ËøáÁßªÂä®
                if (enemy.stunTimer > 0 && !enemy.immuneToStun) {
                    enemy.stunTimer -= 16;
                    return;
                }
                
                const target = path[enemy.pathIndex];
                const dx = target.x - enemy.x;
                const dy = target.y - enemy.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < enemy.speed) {
                    enemy.x = target.x;
                    enemy.y = target.y;
                    enemy.pathIndex++;
                    
                    if (enemy.pathIndex >= path.length) {
                        // Êïå‰∫∫Âà∞ËææÁªàÁÇπÔºåÊ†πÊçÆÊïå‰∫∫Á±ªÂûãËÆ°ÁÆó‰º§ÂÆ≥
                        const damage = enemy.isBoss ? 2 * enemy.bossDamageMultiplier : 1;
                        lives -= damage;
                        updateGameInfo();
                        removeEnemy(enemy);
                        
                        if (lives <= 0) {
                            gameOver();
                        }
                        return;
                    }
                } else {
                    enemy.x += (dx / distance) * enemy.speed;
                    enemy.y += (dy / distance) * enemy.speed;
                }
                
                enemy.element.style.left = `${enemy.x-15}px`;
                enemy.element.style.top = `${enemy.y-15}px`;
                
                // È≠îÊ≥ïÂÖîÂè¨Âî§Â∞èÂÖî
                if (enemy.summonMinions && enemy.minionCooldown <= 0) {
                    if (Math.random() < 0.01) {
                        createSingleEnemy('üêá');
                        enemy.minionCooldown = 5000;
                        
                        // ÊòæÁ§∫Âè¨Âî§ÊïàÊûú
                        const summonEffect = document.createElement('div');
                        summonEffect.textContent = '‚ú®';
                        summonEffect.style.position = 'absolute';
                        summonEffect.style.left = `${enemy.x-15}px`;
                        summonEffect.style.top = `${enemy.y-30}px`;
                        document.getElementById('game-board').appendChild(summonEffect);
                        
                        setTimeout(() => {
                            summonEffect.remove();
                        }, 1000);
                    }
                } else {
                    enemy.minionCooldown -= 16;
                }
                
                // ÊØíÊ∂≤ËúóÁâõÁïô‰∏ãÊØíÊ∂≤
                if (enemy.isToxic && Math.random() < 0.02) {
                    // ÂàõÂª∫ÊØíÊ∂≤ÊïàÊûú
                    const toxicEffect = document.createElement('div');
                    toxicEffect.textContent = 'üíß';
                    toxicEffect.style.position = 'absolute';
                    toxicEffect.style.left = `${enemy.x-10}px`;
                    toxicEffect.style.top = `${enemy.y-10}px`;
                    toxicEffect.style.fontSize = '20px';
                    toxicEffect.style.color = '#7cb342';
                    toxicEffect.style.zIndex = '2';
                    toxicEffect.style.opacity = '0.7';
                    document.getElementById('game-board').appendChild(toxicEffect);
                    
                    setTimeout(() => {
                        toxicEffect.remove();
                    }, 5000);
                }
            });
            
            // Êõ¥Êñ∞Èò≤Âæ°Â°îÊîªÂáª
            towers.forEach(tower => {
                // Â¶ÇÊûúÂ°îË¢´Á¶ÅÁî®ÔºåË∑≥ËøáÊîªÂáª
                if (tower.disableTimer > 0) {
                    tower.disableTimer -= 16;
                    return;
                }
                
                if (tower.isMine) {
                    // Â§ÑÁêÜÂú∞Èõ∑
                    if (tower.mineActive) {
                        enemies.forEach(enemy => {
                            const dx = enemy.x - tower.x;
                            const dy = enemy.y - tower.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance < 60) {
                                // Âú∞Èõ∑ÁàÜÁÇ∏
                                enemy.health -= tower.damage;
                                enemy.healthFill.style.width = `${(enemy.health / enemy.maxHealth) * 100}%`;
                                if (enemy.health <= 0) {
                                    money += Math.round(enemy.reward * difficultySettings[difficulty].rewardMultiplier);
                                    gameStats.enemiesDefeated++;
                                    gameStats.totalMoneyEarned += Math.round(enemy.reward * difficultySettings[difficulty].rewardMultiplier);
                                    if (enemy.isGolem) {
                                        gameStats.bossesDefeated++;
                                    }
                                    updateGameInfo();
                                    removeEnemy(enemy);
                                    checkAchievements();
                                }
                                
                                // ÁßªÈô§Âú∞Èõ∑
                                tower.element.remove();
                                const index = towers.indexOf(tower);
                                if (index !== -1) {
                                    towers.splice(index, 1);
                                }
                                
                                // ÂàõÂª∫ÁàÜÁÇ∏ÊïàÊûú
                                const explosion = document.createElement('div');
                                explosion.className = 'projectile';
                                explosion.textContent = 'üí•';
                                explosion.style.left = `${tower.x-20}px`;
                                explosion.style.top = `${tower.y-20}px`;
                                explosion.style.fontSize = '40px';
                                document.getElementById('game-board').appendChild(explosion);
                                projectileElements.push(explosion);
                                
                                setTimeout(() => {
                                    explosion.remove();
                                    const index = projectileElements.indexOf(explosion);
                                    if (index !== -1) {
                                        projectileElements.splice(index, 1);
                                    }
                                }, 500);
                                
                                playSound('enemyDefeated');
                            }
                        });
                    }
                    return;
                }
                
                if (tower.cooldown > 0) {
                    tower.cooldown -= 16;
                    return;
                }
                
                // ÂØªÊâæÊúÄËøëÁöÑÊïå‰∫∫
                let closestEnemy = null;
                let minDistance = Infinity;
                
                enemies.forEach(enemy => {
                    // È£ûË°åÊïå‰∫∫Âè™ËÉΩË¢´ÁâπÂÆöÂ°îÊîªÂáª
                    if (enemy.isFlying && tower.type !== 'corn-cannon' && tower.type !== 'melon-pult' && 
                        tower.type !== 'cactus' && tower.type !== 'mushroom') return;
                    
                    const dx = enemy.x - tower.x;
                    const dy = enemy.y - tower.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < tower.range && distance < minDistance) {
                        closestEnemy = enemy;
                        minDistance = distance;
                    }
                });
                
                if (closestEnemy) {
                    // ÊîªÂáªÊïå‰∫∫
                    tower.cooldown = towerData[tower.type].cooldown;
                    createProjectile(tower, closestEnemy);
                    playSound('towerAttack');
                }
            });
            
            // Êõ¥Êñ∞ÊäïÂ∞ÑÁâ©
            projectiles.forEach((proj, index) => {
                const dx = proj.target.x - proj.x;
                const dy = proj.target.y - proj.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 10) {
                    // Ê£ÄÊü•Êïå‰∫∫ÊòØÂê¶Èó™ÈÅø
                    if (proj.target.dodgeChance > 0 && Math.random() < proj.target.dodgeChance) {
                        // ÊòæÁ§∫Èó™ÈÅøÊïàÊûú
                        const dodgeText = document.createElement('div');
                        dodgeText.textContent = 'Èó™ÈÅø!';
                        dodgeText.style.position = 'absolute';
                        dodgeText.style.left = `${proj.target.x-15}px`;
                        dodgeText.style.top = `${proj.target.y-30}px`;
                        dodgeText.style.color = '#2196F3';
                        dodgeText.style.fontWeight = 'bold';
                        document.getElementById('game-board').appendChild(dodgeText);
                        
                        setTimeout(() => {
                            dodgeText.remove();
                        }, 500);
                    } else {
                        // ËÆ°ÁÆó‰º§ÂÆ≥
                        let damage = proj.damage;
                        
                        // Ë£ÖÁî≤Êïå‰∫∫ÂáèÂ∞ë‰º§ÂÆ≥
                        if (proj.target.isArmored) {
                            damage = Math.round(damage * (1 - proj.target.armor));
                        }
                        
                        // Ê£ÄÊü•Êö¥Âáª
                        if (proj.critChance && Math.random() < proj.critChance) {
                            damage *= 2;
                            
                            // ÊòæÁ§∫Êö¥ÂáªÊïàÊûú
                            const critText = document.createElement('div');
                            critText.textContent = 'Êö¥Âáª!';
                            critText.style.position = 'absolute';
                            critText.style.left = `${proj.target.x-15}px`;
                            critText.style.top = `${proj.target.y-30}px`;
                            critText.style.color = '#FF5722';
                            critText.style.fontWeight = 'bold';
                            document.getElementById('game-board').appendChild(critText);
                            
                            setTimeout(() => {
                                critText.remove();
                            }, 500);
                        }
                        
                        // ÈÄ†Êàê‰º§ÂÆ≥
                        proj.target.health -= damage;
                        proj.target.healthFill.style.width = `${(proj.target.health / proj.target.maxHealth) * 100}%`;
                        
                        // Â¶ÇÊûúÊòØÂ§ßËíúÂ°îÔºåÁú©ÊôïÊïå‰∫∫
                        if (proj.stunDuration > 0 && !proj.target.immuneToStun) {
                            proj.target.stunTimer = proj.stunDuration;
                            
                            // ÊòæÁ§∫Áú©ÊôïÊïàÊûú
                            const stunEffect = document.createElement('div');
                            stunEffect.textContent = 'üí´';
                            stunEffect.style.position = 'absolute';
                            stunEffect.style.left = `${proj.target.x-15}px`;
                            stunEffect.style.top = `${proj.target.y-30}px`;
                            document.getElementById('game-board').appendChild(stunEffect);
                            
                            setTimeout(() => {
                                stunEffect.remove();
                            }, proj.stunDuration);
                        }
                        
                        // Â¶ÇÊûúÊòØËçâËéìÂ∞ÑÊâãÔºå‰ΩøÊïå‰∫∫‰∏≠ÊØí
                        if (proj.poisonChance && Math.random() < proj.poisonChance) {
                            proj.target.poisoned = {
                                damage: proj.poisonDamage,
                                duration: proj.poisonDuration,
                                timer: proj.poisonDuration
                            };
                            
                            // ÊòæÁ§∫‰∏≠ÊØíÊïàÊûú
                            const poisonEffect = document.createElement('div');
                            poisonEffect.textContent = '‚ò†Ô∏è';
                            poisonEffect.style.position = 'absolute';
                            poisonEffect.style.left = `${proj.target.x-15}px`;
                            poisonEffect.style.top = `${proj.target.y-30}px`;
                            document.getElementById('game-board').appendChild(poisonEffect);
                            
                            setTimeout(() => {
                                poisonEffect.remove();
                            }, proj.poisonDuration);
                        }
                        
                        // Â¶ÇÊûúÊòØËùéÂ≠êÊàñÂ∑®ÈæôÔºåÁ¶ÅÁî®Èò≤Âæ°Â°î
                        if (proj.target.canDisableTowers) {
                            // ÊâæÂà∞ÊúÄËøëÁöÑÈò≤Âæ°Â°î
                            let closestTower = null;
                            let minDistance = Infinity;
                            
                            towers.forEach(tower => {
                                if (!tower.isMine) {
                                    const dx = tower.x - proj.target.x;
                                    const dy = tower.y - proj.target.y;
                                    const distance = Math.sqrt(dx * dx + dy * dy);
                                    
                                    if (distance < 100 && distance < minDistance) {
                                        closestTower = tower;
                                        minDistance = distance;
                                    }
                                }
                            });
                            
                            if (closestTower) {
                                closestTower.disableTimer = 3000; // Á¶ÅÁî®3Áßí
                                
                                // ÊòæÁ§∫Á¶ÅÁî®ÊïàÊûú
                                const disableEffect = document.createElement('div');
                                disableEffect.textContent = '‚ùå';
                                disableEffect.style.position = 'absolute';
                                disableEffect.style.left = `${closestTower.x-15}px`;
                                disableEffect.style.top = `${closestTower.y-30}px`;
                                disableEffect.style.fontSize = '20px';
                                document.getElementById('game-board').appendChild(disableEffect);
                                
                                setTimeout(() => {
                                    disableEffect.remove();
                                }, 3000);
                            }
                        }
                        
                        // Â¶ÇÊûúÊòØË•øÁìúÊäïÊâãÊàñËè†ËêùÁÇ∏ÂºπÔºåÈÄ†ÊàêÊ∫ÖÂ∞Ñ‰º§ÂÆ≥
                        if (proj.splashRadius > 0) {
                            enemies.forEach(enemy => {
                                if (enemy !== proj.target) {
                                    const dx = enemy.x - proj.target.x;
                                    const dy = enemy.y - proj.target.y;
                                    const distance = Math.sqrt(dx * dx + dy * dy);
                                    
                                    if (distance < proj.splashRadius) {
                                        let splashDamage = damage * 0.5; // Ê∫ÖÂ∞Ñ‰º§ÂÆ≥‰∏∫50%
                                        
                                        // Ë£ÖÁî≤Êïå‰∫∫ÂáèÂ∞ë‰º§ÂÆ≥
                                        if (enemy.isArmored) {
                                            splashDamage = Math.round(splashDamage * (1 - enemy.armor));
                                        }
                                        
                                        enemy.health -= splashDamage;
                                        enemy.healthFill.style.width = `${(enemy.health / enemy.maxHealth) * 100}%`;
                                        
                                        if (enemy.health <= 0) {
                                            money += Math.round(enemy.reward * difficultySettings[difficulty].rewardMultiplier);
                                            gameStats.enemiesDefeated++;
                                            gameStats.totalMoneyEarned += Math.round(enemy.reward * difficultySettings[difficulty].rewardMultiplier);
                                            if (enemy.isGolem) {
                                                gameStats.bossesDefeated++;
                                            }
                                            updateGameInfo();
                                            removeEnemy(enemy);
                                            checkAchievements();
                                        }
                                    }
                                }
                            });
                        }
                        
                        // Â¶ÇÊûúÊòØ‰ªô‰∫∫ÊéåÂ∞ÑÊâãÔºåÊúâÂá†ÁéáÁ©øÈÄèÊïå‰∫∫
                        if (proj.pierceChance && Math.random() < proj.pierceChance) {
                            // ÂØªÊâæÁ©øÈÄèË∑ØÂæÑ‰∏äÁöÑÂÖ∂‰ªñÊïå‰∫∫
                            enemies.forEach(enemy => {
                                if (enemy !== proj.target) {
                                    const dx = enemy.x - proj.target.x;
                                    const dy = enemy.y - proj.target.y;
                                    const distance = Math.sqrt(dx * dx + dy * dy);
                                    
                                    // Ê£ÄÊü•ÊòØÂê¶Âú®Á©øÈÄèË∑ØÂæÑ‰∏ä
                                    if (distance < 100 && Math.abs(Math.atan2(dy, dx) - Math.atan2(proj.dy, proj.dx)) < 0.2) {
                                        let pierceDamage = damage * 0.7; // Á©øÈÄè‰º§ÂÆ≥‰∏∫70%
                                        
                                        // Ë£ÖÁî≤Êïå‰∫∫ÂáèÂ∞ë‰º§ÂÆ≥
                                        if (enemy.isArmored) {
                                            pierceDamage = Math.round(pierceDamage * (1 - enemy.armor));
                                        }
                                        
                                        enemy.health -= pierceDamage;
                                        enemy.healthFill.style.width = `${(enemy.health / enemy.maxHealth) * 100}%`;
                                        
                                        if (enemy.health <= 0) {
                                            money += Math.round(enemy.reward * difficultySettings[difficulty].rewardMultiplier);
                                            gameStats.enemiesDefeated++;
                                            gameStats.totalMoneyEarned += Math.round(enemy.reward * difficultySettings[difficulty].rewardMultiplier);
                                            if (enemy.isGolem) {
                                                gameStats.bossesDefeated++;
                                            }
                                            updateGameInfo();
                                            removeEnemy(enemy);
                                            checkAchievements();
                                        }
                                    }
                                }
                            });
                        }
                        
                        // Â¶ÇÊûúÊòØËòëËèá‰∫ëÔºåÂáèÈÄüÊïå‰∫∫
                        if (proj.slowEffect > 0 && !proj.target.immuneToSlow) {
                            proj.target.slowed = {
                                effect: proj.slowEffect,
                                duration: proj.slowDuration,
                                timer: proj.slowDuration
                            };
                            
                            // ÊòæÁ§∫ÂáèÈÄüÊïàÊûú
                            const slowEffect = document.createElement('div');
                            slowEffect.textContent = 'üêå';
                            slowEffect.style.position = 'absolute';
                            slowEffect.style.left = `${proj.target.x-15}px`;
                            slowEffect.style.top = `${proj.target.y-30}px`;
                            document.getElementById('game-board').appendChild(slowEffect);
                            
                            setTimeout(() => {
                                slowEffect.remove();
                            }, proj.slowDuration);
                        }
                        
                        if (proj.target.health <= 0) {
                            money += Math.round(proj.target.reward * difficultySettings[difficulty].rewardMultiplier);
                            gameStats.enemiesDefeated++;
                            gameStats.totalMoneyEarned += Math.round(proj.target.reward * difficultySettings[difficulty].rewardMultiplier);
                            if (proj.target.isGolem) {
                                gameStats.bossesDefeated++;
                            }
                            updateGameInfo();
                            removeEnemy(proj.target);
                            checkAchievements();
                            playSound('enemyDefeated');
                        }
                    }
                    
                    // ÁßªÈô§ÊäïÂ∞ÑÁâ©
                    proj.element.remove();
                    const projIndex = projectileElements.indexOf(proj.element);
                    if (projIndex !== -1) {
                        projectileElements.splice(projIndex, 1);
                    }
                    projectiles.splice(index, 1);
                } else {
                    // ÁßªÂä®ÊäïÂ∞ÑÁâ©
                    proj.x += (dx / distance) * 8;
                    proj.y += (dy / distance) * 8;
                    proj.element.style.left = `${proj.x-10}px`;
                    proj.element.style.top = `${proj.y-10}px`;
                }
            });
            
            // Â§ÑÁêÜ‰∏≠ÊØíÊïàÊûú
            enemies.forEach(enemy => {
                if (enemy.poisoned && enemy.poisoned.timer > 0) {
                    enemy.poisoned.timer -= 16;
                    if (enemy.poisoned.timer % 1000 < 16) {
                        // ÊØèÁßíÈÄ†Êàê‰∏≠ÊØí‰º§ÂÆ≥
                        enemy.health -= enemy.poisoned.damage;
                        enemy.healthFill.style.width = `${(enemy.health / enemy.maxHealth) * 100}%`;
                        
                        // ÊòæÁ§∫‰∏≠ÊØí‰º§ÂÆ≥
                        const poisonDamage = document.createElement('div');
                        poisonDamage.textContent = `-${enemy.poisoned.damage}`;
                        poisonDamage.style.position = 'absolute';
                        poisonDamage.style.left = `${enemy.x-15}px`;
                        poisonDamage.style.top = `${enemy.y-30}px`;
                        poisonDamage.style.color = '#7cb342';
                        poisonDamage.style.fontWeight = 'bold';
                        document.getElementById('game-board').appendChild(poisonDamage);
                        
                        setTimeout(() => {
                            poisonDamage.style.top = `${enemy.y-50}px`;
                            poisonDamage.style.opacity = '0';
                            setTimeout(() => {
                                poisonDamage.remove();
                            }, 500);
                        }, 100);
                        
                        if (enemy.health <= 0) {
                            money += Math.round(enemy.reward * difficultySettings[difficulty].rewardMultiplier);
                            gameStats.enemiesDefeated++;
                            gameStats.totalMoneyEarned += Math.round(enemy.reward * difficultySettings[difficulty].rewardMultiplier);
                            if (enemy.isGolem) {
                                gameStats.bossesDefeated++;
                            }
                            updateGameInfo();
                            removeEnemy(enemy);
                            checkAchievements();
                        }
                    }
                    
                    if (enemy.poisoned.timer <= 0) {
                        delete enemy.poisoned;
                    }
                }
                
                // Â§ÑÁêÜÂáèÈÄüÊïàÊûú
                if (enemy.slowed && enemy.slowed.timer > 0 && !enemy.immuneToSlow) {
                    enemy.slowed.timer -= 16;
                    enemy.speed = enemy.originalSpeed * (1 - enemy.slowed.effect);
                    
                    if (enemy.slowed.timer <= 0) {
                        enemy.speed = enemy.originalSpeed;
                        delete enemy.slowed;
                    }
                }
            });
        }
        
        // ÂàõÂª∫ÊäïÂ∞ÑÁâ©
        function createProjectile(tower, enemy) {
            const projectile = {
                type: tower.type,
                x: tower.x,
                y: tower.y,
                target: enemy,
                damage: tower.damage,
                element: null,
                critChance: tower.critChance,
                stunDuration: tower.stunDuration,
                splashRadius: tower.splashRadius,
                // Êñ∞ÁÇÆÂè∞ÁâπÊúâÂ±ûÊÄß
                poisonChance: tower.poisonChance,
                poisonDuration: tower.poisonDuration,
                poisonDamage: tower.poisonDamage,
                pierceChance: tower.pierceChance,
                slowEffect: tower.slowEffect,
                slowDuration: tower.slowDuration,
                // ËÆ∞ÂΩïÊñπÂêëÁî®‰∫éÁ©øÈÄèËÆ°ÁÆó
                dx: enemy.x - tower.x,
                dy: enemy.y - tower.y
            };
            
            projectiles.push(projectile);
            
            // Âú®È°µÈù¢‰∏äÊòæÁ§∫ÊäïÂ∞ÑÁâ©
            const projElement = document.createElement('div');
            projElement.className = 'projectile';
            
            // ‰∏çÂêåÂ°îÊúâ‰∏çÂêåÁöÑÊäïÂ∞ÑÁâ©Â§ñËßÇ
            switch(tower.type) {
                case 'pea-shooter':
                    projElement.textContent = '‚Ä¢';
                    projElement.style.color = '#2e7d32';
                    break;
                case 'pepper-thrower':
                    projElement.textContent = 'üî•';
                    break;
                case 'onion-guard':
                    projElement.textContent = 'üíß';
                    projElement.style.color = '#ffeb3b';
                    break;
                case 'corn-cannon':
                    projElement.textContent = 'üåΩ';
                    break;
                case 'garlic-tower':
                    projElement.textContent = 'üßÑ';
                    projElement.style.color = '#f8bbd0';
                    break;
                case 'cabbage-pult':
                    projElement.textContent = 'ü•¨';
                    projElement.style.color = '#dce775';
                    break;
                case 'melon-pult':
                    projElement.textContent = 'üçâ';
                    break;
                case 'strawberry':
                    projElement.textContent = 'üçì';
                    projElement.style.color = '#f44336';
                    break;
                case 'pineapple':
                    projElement.textContent = 'üçç';
                    projElement.style.color = '#ffeb3b';
                    break;
                case 'cactus':
                    projElement.textContent = 'üåµ';
                    projElement.style.color = '#4caf50';
                    break;
                case 'mushroom':
                    projElement.textContent = '‚òÅÔ∏è';
                    projElement.style.color = '#7b1fa2';
                    break;
            }
            
            projElement.style.left = `${tower.x-10}px`;
            projElement.style.top = `${tower.y-10}px`;
            document.getElementById('game-board').appendChild(projElement);
            projectile.element = projElement;
            projectileElements.push(projElement);
        }
        
        // ÁßªÈô§Êïå‰∫∫
        function removeEnemy(enemy) {
            enemy.element.remove();
            const index = enemies.indexOf(enemy);
            if (index !== -1) {
                enemies.splice(index, 1);
            }
            const elementIndex = enemyElements.indexOf(enemy.element);
            if (elementIndex !== -1) {
                enemyElements.splice(elementIndex, 1);
            }
        }
        
        // Ê∏∏ÊàèÁªìÊùü
        function gameOver() {
            clearInterval(window.gameLoop);
            window.gameLoop = null;
            if (sunflowerInterval) {
                clearInterval(sunflowerInterval);
                sunflowerInterval = null;
            }
            showMessage(`Ê∏∏ÊàèÁªìÊùü! ‰Ω†ÂùöÊåÅ‰∫Ü ${wave} Ê≥¢`);
            document.getElementById('start-button').disabled = true;
            playSound('gameOver');
        }
        
        // Êõ¥Êñ∞Ê∏∏Êàè‰ø°ÊÅØ
        function updateGameInfo() {
            document.getElementById('money').textContent = money;
            document.getElementById('lives').textContent = lives;
            document.getElementById('wave').textContent = wave;
            document.getElementById('max-wave').textContent = maxWave;
            document.getElementById('achievement-count').textContent = gameStats.achievementsUnlocked;
            
            // Êõ¥Êñ∞Èò≤Âæ°Â°îÈÄâÈ°πÁöÑÂèØË¥≠‰π∞Áä∂ÊÄÅ
            document.querySelectorAll('.tower-option').forEach(opt => {
                const type = opt.className.split(' ')[1];
                if (money < getTowerCost(type)) {
                    opt.style.opacity = '0.5';
                } else {
                    opt.style.opacity = '1';
                }
            });
        }
        
        // ÊòæÁ§∫Ê∂àÊÅØ
        function showMessage(msg) {
            document.getElementById('message').textContent = msg;
        }
        
        // Êí≠ÊîæÈü≥Êïà
        function playSound(type) {
            if (!soundEnabled) return;
            const sound = sounds[type];
            if (sound) {
                sound.currentTime = 0;
                sound.play().catch(e => console.log('Êó†Ê≥ïÊí≠ÊîæÈü≥Êïà:', e));
            }
        }
        
        // Ê£ÄÊü•ÊàêÂ∞±
        function checkAchievements() {
            let newAchievements = false;
            let unlockedNewTower = false;
            
            achievementData.forEach(ach => {
                if (!achievements.includes(ach.id) && ach.condition(gameStats)) {
                    achievements.push(ach.id);
                    gameStats.achievementsUnlocked++;
                    showMessage(`ÊàêÂ∞±Ëß£ÈîÅ: ${ach.name}!`);
                    newAchievements = true;
                    
                    // Ëß£ÈîÅÊñ∞ÁÇÆÂè∞
                    if (ach.unlockTower && !unlockedTowers[ach.unlockTower]) {
                        unlockedTowers[ach.unlockTower] = true;
                        unlockedNewTower = true;
                        
                        // ÊòæÁ§∫Ëß£ÈîÅÈÄöÁü•
                        const unlockNotification = document.createElement('div');
                        unlockNotification.className = 'unlock-notification';
                        unlockNotification.textContent = `Ëß£ÈîÅÊñ∞ÁÇÆÂè∞: ${towerData[ach.unlockTower].name} ${towerData[ach.unlockTower].emoji}`;
                        document.body.appendChild(unlockNotification);
                        
                        setTimeout(() => {
                            unlockNotification.remove();
                        }, 3000);
                        
                        playSound('unlock');
                    }
                    
                    // ÊòæÁ§∫ÊàêÂ∞±Ëß£ÈîÅÊïàÊûú
                    const achievementUnlocked = document.createElement('div');
                    achievementUnlocked.className = 'special-wave';
                    achievementUnlocked.textContent = `ÊàêÂ∞±Ëß£ÈîÅ: ${ach.name}!`;
                    achievementUnlocked.style.backgroundColor = 'rgba(255, 215, 0, 0.8)';
                    document.getElementById('game-board').appendChild(achievementUnlocked);
                    
                    setTimeout(() => {
                        achievementUnlocked.remove();
                    }, 3000);
                }
            });
            
            if (newAchievements) {
                updateGameInfo();
                if (!unlockedNewTower) {
                    playSound('upgrade');
                }
            }
            
            if (unlockedNewTower) {
                updateTowerSelector();
            }
        }
        
        // ÂàùÂßãÂåñÊ∏∏Êàè
        initGame();
    </script>
</body>
</html>